<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ç†è§£Androidä¸­Serviceçš„Binderè·¨è¿›ç¨‹é€šä¿¡æœºåˆ¶ | imlk&#39;s blog</title>
  <link rel="stylesheet" href='/css/style.css' />
  <link rel="stylesheet" href='/css/fonts.css' />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
</head>

<body>
  <header class="header">
    <a class="logo" href='/'> imlk's Blog </a>
    <nav>
      <ul class="menu">
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/about/">About</a></li>
        
        <li><a href="/archives/">Archives</a></li>
        
        <li><a href="/friends/">Friends</a></li>
        
        <li><a href="/index.xml">Subscribe</a></li>
        
      </ul>
    </nav>
  </header>
  <hr />



<div class="article-meta">
    <h1><span class="title">ç†è§£Androidä¸­Serviceçš„Binderè·¨è¿›ç¨‹é€šä¿¡æœºåˆ¶</span></h1>
    
    <span>
        <span class="date">2018-04-11</span>
        |
        
        <span class="cats">
            
            
            <a href='https://blog.imlk.top/categories/android/'>Android</a>
            
        </span>
        
        |
        <span class="tags">
            
            <a href='https://blog.imlk.top/tags/android/'>#Android</a>
            
            <a href='https://blog.imlk.top/tags/binder/'>#Binder</a>
            
            <a href='https://blog.imlk.top/tags/ipc/'>#IPC</a>
            
            <a href='https://blog.imlk.top/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/'>#è¯»ä¹¦ç¬”è®°</a>
            
        </span>
        
    </span>
    <br>
    
</div>


<main>
    <p>ä»Šå¤©æ‹œè¯»äº†å§œç»´å¤§ç¥çš„<code>Androidç³»ç»Ÿç¯‡ä¹‹----Binderæœºåˆ¶å’Œè¿œç¨‹æœåŠ¡è°ƒç”¨æœºåˆ¶åˆ†æ</code></p>
<p><a href="https://blog.csdn.net/jiangwei0910410003/article/details/52467919">Androidç³»ç»Ÿç¯‡ä¹‹&mdash;-Binderæœºåˆ¶å’Œè¿œç¨‹æœåŠ¡è°ƒç”¨æœºåˆ¶åˆ†æ</a></p>
<p>è¯»å®Œæœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œå°±æ˜¯
æ–‡ä¸­</p>
<blockquote>
<p>6ã€æœ€åè¿”å›çš„å¯¹è±¡å…¶å®å°±æ˜¯è¿™ä¸ª<code>Proxy</code>å¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹è±¡å†…éƒ¨ä½¿ç”¨äº†é™æ€ä»£ç†æ–¹å¼ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªæ¥è‡ªè¿œç«¯çš„<code>mRemote</code>å˜é‡å³<code>IBinder</code>å¯¹è±¡ã€‚ç„¶åç›´æ¥è°ƒç”¨æ–¹æ³•å…¶å®å°±æ˜¯è°ƒç”¨<code>mRemote</code>çš„<code>transact</code>æ–¹æ³•è¿›è¡Œé€šä¿¡äº†ã€‚</p>
</blockquote>
<p><code>IBinder</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…·ä½“çš„å®ç°ç±»æ²¡æœ‰è¯´æ˜ï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯<code>Binder</code>ï¼Œçœ‹äº†ä¸€ä¸‹<code>Binder</code>çš„<code>transact</code>æ–¹æ³•å®ç°ï¼Œå‘ç°ç›´æ¥è°ƒç”¨äº†<code>Stub</code>çš„<code>onTransact</code>ï¼ŒçœŸæ˜¯ç®€ç›´äº†ï¼Œä¸€è„¸æ‡µé€¼å•Šï¼Œè¿™ä¸æ˜¯å°±åœ¨è‡ªå·±çš„è¿›ç¨‹æ‰§è¡Œäº†å˜›ï¼Œ<code>native</code>å‘¢ï¼Ÿåæ¥ä¸Šç½‘æŸ¥å‘ç°è¿™é‡Œçš„<code>mRemote</code>å®é™…ä¸Šæ˜¯</p>
<pre tabindex="0"><code>final class BinderProxy implements IBinder 
</code></pre><p>ä½†åœ¨asé‡Œé¢æœä¸åˆ°è¿™ä¸ªç±»ï¼Œäºæ˜¯å–å‡º<code>framework.jar</code>ç”¨jadxå¼€ï¼Œæœç„¶çœ‹åˆ°<code>android.os.BinderProxy</code>
å…¶ä¸­æœ‰ï¼š</p>
<pre tabindex="0"><code>    public boolean transact(int code, Parcel data, Parcel reply, int flags) throws RemoteException {
        Binder.checkParcel(this, code, data, &quot;Unreasonably large binder buffer&quot;);
        return transactNative(code, data, reply, flags);
    }
</code></pre><p>å’Œ</p>
<pre tabindex="0"><code>	public native boolean transactNative(int i, Parcel parcel, Parcel parcel2, int i2) throws RemoteException;
</code></pre><p><img src="/images/blog/31_0.png" alt="jadxåç¼–è¯‘çš„framework.jar"></p>
<p>è¿™é‡Œ<code>Proxy</code>ç±»ä¸­çš„<code>mRemote</code>ç±»å‹æ˜¯<code>BinderProxy</code></p>
<pre tabindex="0"><code>mRemote.transact(Stub.TRANSACTION_getData, _data, _reply, 0);
</code></pre><p>è¿™å¥å®é™…ä¸Šè°ƒç”¨äº†<code>BinderProxy</code>çš„<code>transact</code>æ–¹æ³•ï¼Œä¸Šé¢çœ‹åˆ°å®ƒè½¬è€Œè°ƒç”¨äº†ä¸€ä¸ª<code>transactNative</code>çš„nativeæ–¹æ³•å®ç°å’Œå†…æ ¸é€šä¿¡</p>
<p>çŒœæƒ³è¿™ä¸ªå› ä¸ºæ˜¯ç³»ç»Ÿçš„å®ç°ï¼Œæ‰€ä»¥asé‡Œé¢æœä¸åˆ°è¿™ä¸ªç±»ï¼ŒçœŸçš„æ˜¯æ‰¾äº†å¥½ä¹…ã€‚ç»ˆäºæ˜ç™½äº†</p>
<p><strong><code>BinderProxy</code>æºç (Android 6.0.1)</strong></p>
<pre tabindex="0"><code>package android.os;

import android.os.IBinder.DeathRecipient;
import android.util.Log;
import java.io.FileDescriptor;
import java.lang.ref.WeakReference;

/* compiled from: Binder */
final class BinderProxy implements IBinder {
    private long mObject;
    private long mOrgue;
    private final WeakReference mSelf = new WeakReference(this);

    private final native void destroy();

    public native String getInterfaceDescriptor() throws RemoteException;

    public native boolean isBinderAlive();

    public native void linkToDeath(DeathRecipient deathRecipient, int i) throws RemoteException;

    public native boolean pingBinder();

    public native boolean transactNative(int i, Parcel parcel, Parcel parcel2, int i2) throws RemoteException;

    public native boolean unlinkToDeath(DeathRecipient deathRecipient, int i);

    public IInterface queryLocalInterface(String descriptor) {
        return null;
    }

    public boolean transact(int code, Parcel data, Parcel reply, int flags) throws RemoteException {
        Binder.checkParcel(this, code, data, &quot;Unreasonably large binder buffer&quot;);
        return transactNative(code, data, reply, flags);
    }

    public void dump(FileDescriptor fd, String[] args) throws RemoteException {
        Parcel data = Parcel.obtain();
        Parcel reply = Parcel.obtain();
        data.writeFileDescriptor(fd);
        data.writeStringArray(args);
        try {
            transact(IBinder.DUMP_TRANSACTION, data, reply, 0);
            reply.readException();
        } finally {
            data.recycle();
            reply.recycle();
        }
    }

    public void dumpAsync(FileDescriptor fd, String[] args) throws RemoteException {
        Parcel data = Parcel.obtain();
        Parcel reply = Parcel.obtain();
        data.writeFileDescriptor(fd);
        data.writeStringArray(args);
        try {
            transact(IBinder.DUMP_TRANSACTION, data, reply, 1);
        } finally {
            data.recycle();
            reply.recycle();
        }
    }

    BinderProxy() {
    }

    protected void finalize() throws Throwable {
        try {
            destroy();
        } finally {
            super.finalize();
        }
    }

    private static final void sendDeathNotice(DeathRecipient recipient) {
        try {
            recipient.binderDied();
        } catch (RuntimeException exc) {
            Log.w(&quot;BinderNative&quot;, &quot;Uncaught exception from death notification&quot;, exc);
        }
    }
}
</code></pre><p>å‚è€ƒï¼š
Androidç³»ç»Ÿç¯‡ä¹‹&mdash;-Binderæœºåˆ¶å’Œè¿œç¨‹æœåŠ¡è°ƒç”¨æœºåˆ¶åˆ†æ
<a href="https://blog.csdn.net/jiangwei0910410003/article/details/52467919">https://blog.csdn.net/jiangwei0910410003/article/details/52467919</a>
Androidç³»ç»Ÿè¿›ç¨‹é—´é€šä¿¡Binderæœºåˆ¶åœ¨åº”ç”¨ç¨‹åºæ¡†æ¶å±‚çš„Javaæ¥å£æºä»£ç åˆ†æ
<a href="https://www.linuxidc.com/Linux/2011-07/39620p9.htm">https://www.linuxidc.com/Linux/2011-07/39620p9.htm</a></p>

</main>



<div id="comments">
    <hr>
    <script src="https://utteranc.es/client.js" repo='KB5201314/KB5201314.github.io' issue-term="pathname" label='ğŸ’¬ comments ğŸ’¬'
        theme='github-light' crossorigin="anonymous" async>
        </script>
</div>


  <footer>
  
  <hr/>
  Â© imlk 2017 &ndash; 2021 | <a href="https://blog.imlk.top">imlk's blog</a> | <a href="https://github.com/KB5201314/">Github</a> | <a href="mailto:me@imlk.top">Email</a> | <a href="https://beian.miit.gov.cn/">äº¬ICPå¤‡ - 2020042968å·</a>
  
  </footer>
  </body>
</html>
