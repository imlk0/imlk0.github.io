<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>SoK: Understanding the Prevailing Security Vulnerabilities in TrustZone-assisted TEE Systems 论文阅读 | imlk's blog</title>
<link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel=stylesheet></head><body><header class=header><a class=logo href=/>imlk's Blog</a><nav><ul class=menu><li><a href=/>🏠Home</a></li><li><a href=/about/>👋About</a></li><li><a href=/archives/>📜Archives</a></li><li><a href=/friends/>🔗Friends</a></li><li><a href=/dn42/>🕸️DN42</a></li><li><a href=/index.xml>📢Subscribe</a></li></ul></nav></header><hr><div class=article-meta><h1><span class=title>SoK: Understanding the Prevailing Security Vulnerabilities in TrustZone-assisted TEE Systems 论文阅读</span></h1><span><span class=date>📅 2022-05-03</span>
<span class=date>(更新于2023-08-30)</span>
/
<span class=cats>📚
<a href=https://blog.imlk.top/categories/tee/>TEE</a>
</span>/
<span class=tags>🏷️
<a href=https://blog.imlk.top/tags/trustzone/>#TrustZone</a>
<a href=https://blog.imlk.top/tags/security/>#Security</a>
<a href=https://blog.imlk.top/tags/reading/>#Reading</a></span></span><br></div><main class=post-content><ul><li><a href=https://www.cs.purdue.edu/homes/pfonseca/papers/sp2020-tees.pdf>PDF version</a></li></ul><p>这是一篇IEEE S&amp;P 2020的论文，这篇文章中，作者通过分析过去几年内TrustZone的TEE有关的上百个漏洞，分析存在的安全问题。</p><ul><li><strong>列举了很多漏洞成因</strong>，部分攻击还举例了相关的工作。</li><li><strong>列举</strong>出了近几年的<strong>一些的防御工作</strong></li></ul><h1 id=总览>总览</h1><h2 id=分析方法论>分析方法论</h2><ul><li><p>攻击的威胁模型：提出了4个不同程度的威胁模型，表示这些漏洞致力于其中的一些目标</p></li><li><p><strong>被分析的TEE实现：</strong> Qualcomm, Trustonic, Huawei, Nvidia, and Linaro.</p></li><li><p>漏洞数据来源：CVE (CVE databases), SVE (SVE databases), SP (scientific publications), MR (miscellaneous reports), and SC (source code, for OP-TEE only）</p></li><li><p>漏洞分级：表格列举了对已被分配CVE的漏洞的严重等级分布</p></li><li><p>二进制分析：<strong>对TEE系统中的子集进行二进制分析</strong></p><ol><li>量化每个TEE系统的TCB范围</li><li>确定具体的软件架构</li><li><strong>分析每个TEE实现的内存保护功能</strong></li></ol><p>对于每个TEE系统只逆向分析了其中的某个版本</p></li><li><p>对结论的有效性的威胁：由于缺乏POC和CVE描述的不准确，作者对漏洞的分类可能是不准确的。</p></li></ul><h1 id=漏洞原因>漏洞原因</h1><h2 id=architectural-issue>architectural issue</h2><p>作者列出了调研的TEE系统的结构</p><p><img src=/images/%5BIEEE%20S&amp;P%202020%5DSoK%20Understanding%20the%20Prevailing%20Se%2015ffe15649f64bbcbfd22191f0c220ba/%E6%88%AA%E5%9B%BE_2022-05-03_16-38-58.png alt="截图 2022-05-03 16-38-58.png"></p><h3 id=tee的攻击面>TEE的攻击面</h3><ul><li>T01. SW drivers run in the TEE kernel space<ul><li>安全世界中的驱动可能是脆弱的但是具有较高的权限级</li></ul></li><li>I02. Wide interfaces between TEE system subcomponents<ul><li>NW中的kernel暴露了太多的接口给普通程序</li><li>SW中的kernel给NW的kernel暴露了很多的SMC调用</li><li>TA给CA暴露了很多cmd</li><li>SW中的kernel给TA暴露了很多syscall并且很少做限制</li></ul></li><li>I03. Excessively large TEE TCBs<ul><li><p>TEE世界中的代码量很大，作者用了一张表格来表示</p><p><img src=/images/%5BIEEE%20S&amp;P%202020%5DSoK%20Understanding%20the%20Prevailing%20Se%2015ffe15649f64bbcbfd22191f0c220ba/%E6%88%AA%E5%9B%BE_2022-05-03_16-54-54.png alt="截图 2022-05-03 16-54-54.png"></p></li></ul></li></ul><h3 id=nw和sw之间的隔离>NW和SW之间的隔离</h3><ul><li>I04. TAs can map physical memory in the NW<ul><li>由于对高效的共享内存机制的需求，一些TEE kernel如QSEE提供系统调用让TA映射任意的NW中的内存</li></ul></li><li>I05. Information leaks to NW through debugging channels<ul><li>一些对TA的调试机制如dump stack trace到NW，将log提供给NW能导致地址信息泄露</li></ul></li></ul><h3 id=内存保护机制>内存保护机制</h3><p><img src=/images/%5BIEEE%20S&amp;P%202020%5DSoK%20Understanding%20the%20Prevailing%20Se%2015ffe15649f64bbcbfd22191f0c220ba/Untitled.png alt=Untitled></p><ul><li>I06. Absent or weak <strong>ASLR</strong> implementations<ul><li>ASLR机制实施不完善，有些TEE中TA被加载到固定的位置</li></ul></li><li>I07. No stack cookies, guard pages, or execution protection</li></ul><h3 id=可信启动>可信启动</h3><ul><li>I08. Lack of software-independent TEE integrity reporting<ul><li>尽管存在安全启动，但是缺乏向远程第三方安全地报告软件完整性测量结果的硬件机制</li></ul></li><li>I09. Ill-supported TA revocation<ul><li>无法正确地处理TA撤销，易受到降级攻击</li></ul></li></ul><h2 id=implementation-issue>implementation issue</h2><h3 id=验证错误validation-bugs>验证错误Validation Bugs</h3><p>Examples include buffer overflows, incorrect parameter validation, mishandled integer overflows, etc.</p><ul><li>I10. Validation bugs within the secure monitor</li><li>I11. Validation bugs within TAs</li><li>I12. Validation bugs within the trusted kernel</li><li>I13. Validation bugs in secure boot loader</li></ul><h3 id=功能性错误functional-bugs>功能性错误Functional Bugs</h3><ul><li>I14. Bugs in memory protection</li><li>I15. Bugs in configuration of peripherals</li><li>I16. Bugs in security mechanisms</li></ul><h3 id=外部错误extrinsic-bugs>外部错误Extrinsic Bugs</h3><ul><li>I17. Concurrency bugs<ul><li>并发访问文件系统(OP-TEE)</li><li>TOCTOU漏洞，系统状态的某些方面在条件检查后发生变化（Trustonic、Nvidia）</li></ul></li><li>I18. Software side-channels</li></ul><h2 id=hardware-issue>hardware issue</h2><h3 id=架构影响architectural-implications>架构影响Architectural Implications</h3><ul><li>I19. Attacks through reconfigurable hardware components<ul><li>一些reconfigurable的平台如FPGA上特有的问题</li></ul></li><li>I20. Attacks through energy management mechanisms<ul><li>通过在NW侧调节频率和电压在SW中诱发错误的计算</li></ul></li></ul><h3 id=微体系结构侧信道>微体系结构侧信道</h3><ul><li>I21. Leaking information through caches</li><li>I22. Leaking information through branch predictor</li><li>I23. Leaking information using Rowhammer</li></ul><h1 id=防御工作>防御工作</h1><p><img src=/images/%5BIEEE%20S&amp;P%202020%5DSoK%20Understanding%20the%20Prevailing%20Se%2015ffe15649f64bbcbfd22191f0c220ba/%E6%88%AA%E5%9B%BE_2022-05-03_19-34-08.png alt="截图 2022-05-03 19-34-08.png"></p><h2 id=体系结构防御architectural-defenses>体系结构防御Architectural Defenses</h2><ul><li>D01. Multi-isolated environments<ul><li>在NW中创建隔离环境<ul><li>利用TZASC：SANCTUARY、TrustICE</li><li>NW中的硬件虚拟化扩展：OSP、PrivateZone、vTZ</li></ul></li><li>加强SW中TA的隔离<ul><li>在SW中实现minimalist hypervisor：TEEv、PrOS<ul><li>并未使用SW中的硬件虚拟化支持</li></ul></li></ul></li></ul></li><li>D02. Secure cross-world channels<ul><li>创建安全的NW-SW通道</li></ul></li><li>D03. Encrypted memory</li><li>D04. Trusted computing primitives</li></ul><h2 id=实现上的防御implementation-defenses>实现上的防御Implementation Defenses</h2><ul><li>D05. Managed code runtimes</li><li>D06. Type-safe programming languages<ul><li>RustZone</li></ul></li><li>D07. Software verification<ul><li>对特定的组件进行形式化验证</li></ul></li></ul><h2 id=硬件防御hardware-defenses>硬件防御Hardware Defenses</h2><ul><li>D08. Architectural countermeasures</li><li>D09. Microarchitectural countermeasures</li></ul><h1 id=除trustzone之外的安全硬件技术>除TrustZone之外的安全硬件技术</h1><p><img src=/images/%5BIEEE%20S&amp;P%202020%5DSoK%20Understanding%20the%20Prevailing%20Se%2015ffe15649f64bbcbfd22191f0c220ba/%E6%88%AA%E5%9B%BE_2022-05-03_20-10-26.png alt="截图 2022-05-03 20-10-26.png"></p></main><div id=comments><hr><script src=//geoip-js.com/js/apis/geoip2/v2.1/geoip2.js type=text/javascript></script><script>var onSuccess=function(e){var t=e.country.names["zh-CN"],n=e.country.iso_code;if(!n)return;t&&(document.getElementById("comments-blocked-country-code").innerHTML=t),n=="CN"&&(document.getElementById("comments-shown").style.display="none",document.getElementById("comments-blocked").style.display="")},onError=function(){};geoip2.country(onSuccess,onError)</script><div id=comments-blocked style=font-style:italic;color:#777;display:none>评论区已关闭。<span style=float:right>来自 <span id=comments-blocked-country-code>unknown</span> 的访客
<span>&nbsp; - powered by: geoip-js.com</span></span></div><div id=comments-shown><script src=https://utteranc.es/client.js repo=KB5201314/KB5201314.github.io issue-term=pathname label='💬 comments 💬' theme=github-light crossorigin=anonymous async></script></div></div><footer class=footer><hr>© imlk 2017 &ndash; 2023 | <a href=https://blog.imlk.top>imlk's blog</a> | <a href=https://github.com/KB5201314/>Github</a> | <a href=mailto:me@imlk.top>Email</a> | <a href=https://beian.miit.gov.cn/>京ICP备2020042968号-1</a></footer></body></html>