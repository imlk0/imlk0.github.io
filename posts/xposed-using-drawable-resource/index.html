<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Xposedæ¨¡å—å¼€å‘â€”â€”åœ¨hookä¹‹åä½¿ç”¨moduleçš„drawableèµ„æº | imlk's blog</title>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/fonts.css>
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel=stylesheet>
</head>
<body>
<header class=header>
<a class=logo href=/> imlk's Blog </a>
<nav>
<ul class=menu>
<li><a href=/>Home</a></li>
<li><a href=/about/>About</a></li>
<li><a href=/archives/>Archives</a></li>
<li><a href=/friends/>Friends</a></li>
<li><a href=/index.xml>Subscribe</a></li>
</ul>
</nav>
</header>
<hr>
<div class=article-meta>
<h1><span class=title>Xposedæ¨¡å—å¼€å‘â€”â€”åœ¨hookä¹‹åä½¿ç”¨moduleçš„drawableèµ„æº</span></h1>
<span>
<span class=date>2017-12-30</span>
|
<span class=cats>
<a href=https://blog.imlk.top/categories/xposed/>Xposed</a>
</span>
|
<span class=tags>
<a href=https://blog.imlk.top/tags/android/>#Android</a>
<a href=https://blog.imlk.top/tags/java/>#Java</a>
<a href=https://blog.imlk.top/tags/xposed/>#Xposed</a>
</span>
</span>
<br>
</div>
<main>
<p>åœ¨xposedå¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°äº†ç›´æ¥ä½¿ç”¨æ¨¡å—å†…ç½®èµ„æºå¤±æ•ˆçš„é—®é¢˜ï¼Œè€Œä¸”è¿™ä¸ªé—®é¢˜å¾ˆè¯¡å¼‚ï¼Œæœ‰æ—¶å€™å¤±æ•ˆï¼Œæœ‰æ—¶å€™æœ‰æ•ˆæœï¼Œæ²¡æ•ˆæœçš„æ—¶å€™ä¸€èˆ¬æ˜¯æ˜¾ç¤ºä¸€æŠŠå‰å‰</p>
<p>åœ¨ä¸Šç½‘æœç´¢åå‘ç°ï¼Œhookå‡½æ•°æ˜¯åœ¨è¢«hookåº”ç”¨å†…éƒ¨æ‰§è¡Œçš„ï¼Œç¯å¢ƒä¸ä¸€æ ·ï¼Œæ‰€ä»¥ç›´æ¥ç”¨R.drawable.xxxçš„æ–¹å¼ä½¿ç”¨ä¼šå‡ºç°é—®é¢˜ã€‚</p>
<h3 id=è§£å†³åŠæ³•>è§£å†³åŠæ³•ï¼š</h3>
<p><a href=https://forum.xda-developers.com/xposed/access-resources-module-t2805276>https://forum.xda-developers.com/xposed/access-resources-module-t2805276</a></p>
<p>å‚è€ƒäº†rovo89å¤§ç¥åœ¨xdaä¸Šé¢çš„å›å¤ï¼Œæ”¹ç”¨</p>
<pre tabindex=0><code>private static String MODULE_PATH = null;
private int mFakeId = 0;

public void initZygote(StartupParam startupParam) throws Throwable {
	MODULE_PATH = startupParam.modulePath;//è·å–æ¨¡å—apkæ–‡ä»¶åœ¨å‚¨å­˜ä¸­çš„ä½ç½®
}

public void handleInitPackageResources(InitPackageResourcesParam resparam) throws Throwable {
	if (!resparam.packageName.equals(&quot;your.target.app&quot;))
	return;

	XModuleResources modRes = XModuleResources.createInstance(MODULE_PATH, resparam.res);
	mFakeId = resparam.res.addResource(modRes, R.drawable.ic_launcher);
}
</code></pre><p><a href=http://api.xposed.info/reference/android/content/res/XResources.html#addResource(android.content.res.Resources,>http://api.xposed.info/reference/android/content/res/XResources.html#addResource(android.content.res.Resources,</a> int)</p>
<p>è·å¾—<code>mFakeld</code>å˜é‡ï¼Œå®ƒå‚¨å­˜çš„æ˜¯åœ¨è¢«hookåº”ç”¨å†…æ¤å…¥çš„ä¸€ä¸ªå‡idï¼Œè¿™ä¸ªidå¯¹åº”çš„æ˜¯moduleé‡Œé¢çš„<code>R.drawable.ic_launcher</code>è¿™ä¸ªèµ„æºï¼Œé€šè¿‡è¿™ä¸ªå‡idå°±å¯ä»¥ä½¿ç”¨åˆ°æˆ‘ä»¬çš„moduleå†…çš„drawableèµ„æºã€‚</p>
<h3 id=å†æ¬¡é‡åˆ°é—®é¢˜>å†æ¬¡é‡åˆ°é—®é¢˜</h3>
<p>åœ¨å®é™…ä½¿ç”¨ä¸­</p>
<pre tabindex=0><code>view.setBackgroundResource(mFakeId);
//å¯¼è‡´å¼‚å¸¸
//No known package when getting value for resource number 0x7e73c7c7&lt;/pre&gt;
</code></pre><h3 id=å†æ¬¡è§£å†³>å†æ¬¡è§£å†³</h3>
<p>æœç´¢åˆ°ä¸€æ®µä»£ç </p>
<p><a href=https://github.com/neverweep/xStatusbarLunarDate/blob/master/src/de/xiaoxia/xstatusbarlunardate/Main.java>https://github.com/neverweep/xStatusbarLunarDate/blob/master/src/de/xiaoxia/xstatusbarlunardate/Main.java</a></p>
<pre tabindex=0><code>@Override
public void handleInitPackageResources(InitPackageResourcesParam resparam){

	if (!resparam.packageName.equals(PACKAGE_NAME))

	return; //å¦‚æœä¸æ˜¯UIåˆ™è·³è¿‡

	//è¿™é‡Œå°†è‡ªå¸¦çš„å›¾æ ‡èµ„æºæ’å…¥åˆ°systemuiä¸­ï¼Œå¹¶è·å–åˆ°ä¸€ä¸ªèµ„æºid

	XModuleResources modRes = XModuleResources.createInstance(MODULE_PATH, resparam.res); //åˆ›å»ºä¸€ä¸ªæ’å…¥èµ„æºçš„å®ä¾‹

	ic_toast_bg_fest = resparam.res.addResource(modRes, R.drawable.ic_toast_bg_fest);

	ic_toast_bg = resparam.res.addResource(modRes, R.drawable.ic_toast_bg);

}
</code></pre><p>ä½¿ç”¨ï¼š</p>
<pre tabindex=0><code>if(_notify_icon){

	//ä¸ºToaståŠ å…¥èƒŒæ™¯
	
	toastView.setBackground((context.getResources().getDrawable(isFest ? ic_toast_bg_fest : ic_toast_bg)));
	
	toastView.setGravity(Gravity.CENTER);
	
	if(toastTextView != null){
	
	toastTextView.setTextColor(0xFF000000);
	
	toastTextView.setPadding(0, 15, 0, 0);
	
	toastTextView.setShadowLayer(0, 0, 0, 0X00FFFFFF);

}
</code></pre><p>è¿™æ®µä»£ç é‡Œé¢ä½¿ç”¨çš„æ˜¯é…åˆ<code>context</code>è·å¾—<code>drawable</code>ï¼Œä½¿ç”¨<code>setBackground()</code>æ–¹æ³•</p>
<p>ç»è¿‡æ£€éªŒï¼Œè¿™ç§å†™æ³•æ­£ç¡®ã€‚</p>
</main>
<div id=comments>
<hr>
<script src=https://utteranc.es/client.js repo=KB5201314/KB5201314.github.io issue-term=pathname label="ğŸ’¬ comments ğŸ’¬" theme=github-light crossorigin=anonymous async></script>
</div>
<footer>
<hr>
Â© imlk 2017 &ndash; 2021 | <a href=https://blog.imlk.top>imlk's blog</a> | <a href=https://github.com/KB5201314/>Github</a> | <a href=mailto:me@imlk.top>Email</a> | <a href=https://beian.miit.gov.cn/>äº¬ICPå¤‡ - 2020042968å·</a>
</footer>
</body>
</html>