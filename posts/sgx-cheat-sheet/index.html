<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>SGX EPID & ECDSA Cheat Sheet | imlk's blog</title>
<link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel=stylesheet></head><body><header class=header><a class=logo href=/>imlk's Blog</a><nav><ul class=menu><li><a href=/>ğŸ Home</a></li><li><a href=/about/>ğŸ‘‹About</a></li><li><a href=/archives/>ğŸ“œArchives</a></li><li><a href=/friends/>ğŸ”—Friends</a></li><li><a href=/dn42/>ğŸ•¸ï¸DN42</a></li><li><a href=/index.xml>ğŸ“¢Subscribe</a></li></ul></nav></header><hr><div class=article-meta><h1><span class=title>SGX EPID & ECDSA Cheat Sheet</span></h1><span><span class=date>ğŸ“… 2022-11-01</span>
<span class=date>(æ›´æ–°äº2023-08-30)</span>
/
<span class=cats>ğŸ“š
<a href=https://blog.imlk.top/categories/tee/>TEE</a>
</span>/
<span class=tags>ğŸ·ï¸
<a href=https://blog.imlk.top/tags/sgx/>#SGX</a>
<a href=https://blog.imlk.top/tags/security/>#Security</a>
<a href=https://blog.imlk.top/tags/cheat-sheet/>#Cheat Sheet</a></span></span><br></div><main class=post-content><p>æ¥è‡ªç‹è€å¸ˆçš„æœºå¯†è®¡ç®—æŠ€æœ¯ç®€ä»‹ï¼š<a href=https://heartever.github.io/files/ConfidentialComputing-Guilin.pdf>https://heartever.github.io/files/ConfidentialComputing-Guilin.pdf</a></p><h1 id=å‚è€ƒé˜…è¯»æ–‡çŒ®>å‚è€ƒé˜…è¯»æ–‡çŒ®</h1><ul><li><a href=https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html>Intel Software Developer&rsquo;s Manuals</a> chapter 35.4</li><li><a href="https://www.notion.so/SGX-a3196a0f115b43e6b125299a00ef48aa?pvs=21">Intel SGX DCAP Quick Install Guide</a></li><li><a href=https://networkbuilders.intel.com/university/course/introduction-to-intelr-sgx-data-center-attestation-primitives-components-and-flows>Introduction to IntelÂ® SGX Data Center Attestation Primitives: Components and Flows</a></li><li><a href=https://download.01.org/intel-sgx/latest/dcap-latest/linux/docs/DCAP_ECDSA_Orientation.pdf>Intel DCAP ECDSA Orientation</a></li><li><a href=https://www.intel.com/content/dam/develop/external/us/en/documents/intel-sgx-support-for-third-party-attestation-801017.pdf>Supporting Third Party Attestation for IntelÂ® SGX with IntelÂ® Data Center Attestation Primitives</a> (ECDSAä¸»è¦çœ‹è¿™ç¯‡æ–‡ç« )</li><li><a href=https://systex.ibr.cs.tu-bs.de/systex19/slides/systex19-keynote-simon.pdf>SGX VC pitch - SysTEX 2019</a></li><li><a href=https://www.intel.com/content/www/us/en/support/articles/000057420/software/intel-security-products.html>Which Platforms Support IntelÂ® Software Guard Extensions (IntelÂ® SGX) Datacenter Attestation Primitives (DCAP)?</a></li><li><a href=https://www.intel.com/content/www/us/en/support/articles/000058764/software/intel-security-products.html>Which Platforms Support IntelÂ® Software Guard Extensions (IntelÂ® SGX) SGX2?</a></li></ul><h1 id=æœ¯è¯­>æœ¯è¯­</h1><ul><li>TCB(Trusted computing base)
ä¸ºå®ç°è®¡ç®—æœºç³»ç»Ÿå®‰å…¨ä¿æŠ¤çš„æ‰€æœ‰å®‰å…¨ä¿æŠ¤æœºåˆ¶çš„é›†åˆï¼Œæœºåˆ¶å¯ä»¥ç¡¬ä»¶ã€å›ºä»¶å’Œè½¯ä»¶çš„å½¢å¼å‡ºç°ã€‚ç°ä»£æ“ä½œç³»ç»ŸåŠªåŠ›é™ä½TCBçš„å¤§å°ã€‚</li></ul><h2 id=ç¡¬ä»¶å®ç°>ç¡¬ä»¶å®ç°</h2><ul><li><p>EPC(Enclave Page Cache)
Enclaveè¢«ä¿å­˜åœ¨EPCä¸­ï¼Œè€ŒEPCä½äºDRAMä¸­çš„å¤„ç†å™¨ä¿ç•™å­˜å‚¨å™¨ï¼ˆPRMï¼‰ä¸­</p></li><li><p>SECS(SGX Enclave Control Structure)
æ¯ä¸ªenclaveä¸€ä¸ª</p></li><li><p>TCS(Thread Control Structure)
æ¯ä¸ªenclaveä¸­åŒ…å«å¤šä¸ªTCSï¼Œæ¯ä¸ªTCSåˆæœ‰ä¸€ä¸ªå¯¹åº”çš„SSA</p></li><li><p>SSA(Save State Area)
æ¯ä¸ªTCSéƒ½æœ‰ä¸€ä¸ªSSAï¼Œå­˜å‚¨äº†å¼‚å¸¸å’Œä¸­æ–­å¤„ç†æ—¶å¤„ç†å™¨çš„çŠ¶æ€ã€‚å¦‚æœæ­£åœ¨è¿è¡Œçš„enclaveè¢«åœæ­¢æˆ–è€…ä¸­æ–­ï¼Œåƒå¯„å­˜å™¨è¿™æ ·çš„ä¸Šä¸‹æ–‡ä¿¡æ¯éƒ½ä¼šä»CPUä¸­æ¸…é™¤å¹¶ç§»åˆ°å®ƒä»¬å„è‡ªçš„EPCä¸­ã€‚</p></li><li><p>SIGSTRUCT and VA Page
æ¯ä¸ªEPCé€šå¸¸æ‹¥æœ‰å®ƒçš„SIGSTRUCTå’ŒVA Page</p></li><li><p>EPCM(Enclave Page Cache Map)ç”¨äºç®¡ç†Enclave Pagesçš„å®‰å…¨å±æ€§ï¼ŒEPCMåŒ…å«äº†EPCä¸­åˆ—å‡ºçš„æ¯ä¸€ä¸ªé¡µé¢çš„è¿›ä¸€æ­¥çš„ä¿¡æ¯ã€‚
EPCMæ˜¯CPUä¸­çš„ä¸€ä¸ªæŸ¥è¯¢è¡¨ï¼Œå…¶ä¸­åŒ…å«äº†enclaveç›¸å…³çš„æ•°æ®</p></li><li><p>MEE(Memory Encryption Engine)
MEEæ˜¯CPUçš„ä¸€éƒ¨åˆ†ï¼Œç”±äºEPCåœ¨DRAMä¸­ï¼ŒCPUåœ¨MEEçš„ååŠ©ä¸‹åŠ å¯†EPCå†…å®¹ï¼Œä»¥ä¿è¯å…¶å®‰å…¨æ€§ï¼Œç¡®ä¿CPUæ˜¯ç³»ç»Ÿä¸­å”¯ä¸€èƒ½å¤Ÿæ­£ç¡®è¯»å–enclaveä¸­çš„æ•°æ®çš„åœ°æ–¹ã€‚</p></li><li><p>åº¦é‡è¿‡ç¨‹</p><p>SGXåœ¨enclaveåˆ›å»ºä¹‹åˆå¯¹æ‰€æœ‰EADDæŒ‡ä»¤æ·»åŠ åˆ°enclaveå†…çš„å†…å­˜å’Œå…¶ä»–å…ƒæ•°æ®è®¡ç®—ä¸€ä¸ª<strong>sha256</strong>ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€measure</p></li></ul><h2 id=è½¯ä»¶æœåŠ¡>è½¯ä»¶æœåŠ¡</h2><ul><li>AESM(Application Enclave Services Manager)
å³SGXåº”ç”¨å®‰å…¨å®¹å™¨çš„æœåŠ¡ç®¡ç†ç³»ç»Ÿã€‚æ˜¯ä¸€ä¸ªç³»ç»ŸæœåŠ¡ï¼Œé€šå¸¸ä½äº<code>/opt/intel/sgx-aesm-service/aesm/aesm_service</code>ï¼Œsgxç¨‹åºé€šè¿‡unix-socketsä¸ä¹‹é€šä¿¡
provides launch support for SGX Enclave, key provisioning, and remote attestation services.</li></ul><h2 id=epidæ¨¡å¼çš„attestation>EPIDæ¨¡å¼çš„attestation</h2><ul><li><p>Intel Enhanced Privacy ID (EPID)</p><p>ä¸€ç»„æœºå™¨å…±åŒä½¿ç”¨ä¸€å¯¹éå¯¹ç§°å¯†é’¥ï¼Œä»¥æä¾›åŒ¿åæ€§å¢å¼º</p></li></ul><h3 id=ä¸¤ä¸ªå¯†é’¥>ä¸¤ä¸ªå¯†é’¥</h3><ul><li><p>Root Provisioning Key (RPK)</p><p>éšæœºå¯†é’¥ï¼Œåœ¨åˆ¶é€ æ—¶åµŒå…¥åˆ°cpuä¸­ï¼Œä¸”intelçŸ¥é“æ‰€æœ‰è®¾å¤‡çš„RPKã€‚è¯¥å¯†é’¥å’Œè¿œç¨‹è¯æ˜ä»¥åŠProvisioning Enclaveæœ‰å…³ã€‚</p></li><li><p>Root Sealing Key (RSK)</p><p>éšæœºå¯†é’¥ï¼Œå‡ºå‚æ—¶åœ¨cpuä¸­äº§ç”Ÿï¼Œintelä¸çŸ¥æ™“è¯¥å¯†é’¥</p><p><code>EGETKEY</code> å€ŸåŠ©è¿™ä¸¤ä¸ªkeyæ´¾ç”Ÿå‡ºä¹‹åçš„æ‰€æœ‰key</p><p><img src=/images/SGX-a3196a0f115b43e6b125299a00ef48aa/Untitled.png alt=Untitled></p></li></ul><h3 id=ä¸¤ä¸ªç‰¹æ®Šçš„enclave>ä¸¤ä¸ªç‰¹æ®Šçš„Enclave</h3><ul><li><p>Provisioning Enclave (PvE)ï¼Œä¾›åº”Enclave</p><p>è´Ÿè´£Platform Provisioningè¿‡ç¨‹ï¼šæ ¹æ®RPKä¸Intel Provisioning Serviceé€šä¿¡ï¼Œæ‰§è¡ŒEPIDåŠ å…¥æµç¨‹ï¼Œè·å¾—EPID private keyï¼Œå³<strong>attestation key</strong>ã€‚</p></li><li><p>Quoting Enclave (QE)</p><p>è´Ÿè´£è¿œç¨‹è¯æ˜è¿‡ç¨‹ã€‚å®ƒéªŒè¯è¯·æ±‚çš„enclaveçš„reportï¼ˆç›¸å½“äºä¸€ä¸ªLAè¿‡ç¨‹ï¼‰ï¼Œç„¶åç”¨ä¸Šä¸€æ­¥PvEæ‹¿åˆ°çš„attestation keyå¯¹reportç­¾åæˆä¸ºquoteï¼Œç„¶åå°†quoteä½¿ç”¨ç¡¬ç¼–ç çš„IASå…¬é’¥è¿›è¡ŒåŠ å¯†ã€‚æœ€åå°†åŠ å¯†å¥½çš„quoteå‘ç»™SPï¼ŒSPæ‹¿å»æ‰¾IASéªŒè¯ã€‚</p><p><img src=/images/SGX-a3196a0f115b43e6b125299a00ef48aa/Untitled1.png alt=Untitled></p></li></ul><h3 id=å…¶ä»–æœåŠ¡ç»„ä»¶>å…¶ä»–æœåŠ¡ç»„ä»¶</h3><ul><li><p>Intel Provisioning Service</p><p>ä¸€ä¸ªåœ¨çº¿æœåŠ¡ï¼Œä¸PvEäº¤äº’ï¼Œè´Ÿè´£EPIDç»„çš„åŠ å…¥ï¼Œä»¥åŠEPID private keyï¼ˆå³attestation key ï¼‰çš„ä¾›åº”è¿‡ç¨‹</p></li><li><p>Intel Attestation Service (IAS)</p><p>ä¸€ä¸ªå¾ˆé‡è¦çš„åœ¨çº¿æœåŠ¡ï¼Œè´Ÿè´£éªŒè¯verifierå‘æ¥çš„evidenceï¼ˆå³åŠ å¯†çš„quoteï¼‰ã€‚</p><p>quoteåªèƒ½ç”±IASè§£å¯†ã€‚è§£å¯†å®ŒæˆåIASä¼šå‘SPè¿”å›ä¸€ä¸ªAttestation Verification Reportï¼Œé‡Œé¢åŒ…å«äº†QEç”Ÿæˆçš„QUOTEç»“æ„ä½“ã€‚</p></li><li><p>Service Provider (SP) æœåŠ¡ä¾›åº”å•†</p><p>åœ¨å®é™…åœºæ™¯ä¸­ï¼Œä¸€ä¸ªService Providerï¼ˆä½œä¸ºverifierï¼‰å¦‚æœæƒ³è¦ä½¿ç”¨IASï¼Œå¿…é¡»å…ˆæ‰¾IASæ³¨å†Œï¼Œå°†è‡ªå·±çš„TLSè¯ä¹¦å’Œè‡ªå·±çš„SPIDç»‘å®šï¼Œæ‰èƒ½ä½¿ç”¨IASçš„æœåŠ¡</p></li></ul><h3 id=æ•°æ®ç»“æ„>æ•°æ®ç»“æ„</h3><ul><li><p>Report (EREPORT)ï¼š</p><p>Hardware report generated by the IntelÂ® SGX HW that provides identity and measurement information of the enclave and the platform. It can be MACâ€™d with a key available to another enclave on the same platform.</p></li><li><p>Quote</p><p>Data structure used to provide proof to an off-platform entity that an application enclave is running with IntelÂ® SGX protections on a trusted IntelÂ® SGX enabled platform.</p><p>é€šå¸¸æ˜¯ç”±Quoting Enclaveäº§ç”Ÿçš„ï¼ŒåŠ å¯†åå‘ç»™IAS</p></li><li><p>Attestation Verification Report</p><p>IASè¿”å›çš„å¯¹quoteçš„éªŒè¯ç»“æœï¼ŒåŒ…å«äº†enclaveäº§ç”Ÿçš„æ•°æ®ï¼Œå¦‚MRENCLAVEã€MRSIGNERç­‰</p></li><li><p>Attestation Verification Report Signature</p><p>ç”±IASå¯¹Attestation Verification Reportåšçš„ç­¾å</p></li><li><p>Attestation Report Signing Certificate</p><p>å’ŒAttestation Verification Report Signatureç­¾åæ‰€ç”¨ç§é’¥å¯¹åº”çš„å…¬é’¥è¯ä¹¦ï¼Œç”±IASè¿”å›</p></li><li><p>Attestation Report Signing CA Certificate</p><p>Attestation Report Signing Certificateçš„ä¸Šçº§CAè¯ä¹¦ï¼Œè¿™æ˜¯Attestation Verification Reportçš„ä¿¡ä»»æ ¹ï¼Œå› æ­¤é€šå¸¸ç”±verifierè‡ªå·±ä»¥å¯ä¿¡çš„æ–¹å¼è·å–ã€‚</p></li></ul><h2 id=ecdsaæ¨¡å¼çš„attestation>ECDSAæ¨¡å¼çš„attestation</h2><ul><li>Data Center Attestation Primitives(DCAP)</li></ul><h3 id=æœåŠ¡ç»„ä»¶>æœåŠ¡ç»„ä»¶</h3><ul><li><p>Intel Provisioning Certification Service (Intel PCS)</p><p>è‹±ç‰¹å°”æä¾›çš„åœ¨çº¿ä¾›åº”è®¤è¯æœåŠ¡ï¼Œå…è®¸æ£€ç´¢å¿…è¦çš„ææ–™ï¼ŒåŒ…æ‹¬PCKè¯ä¹¦ã€PCKè¯ä¹¦æ’¤é”€åˆ—è¡¨(CRLs)ã€‚è¿™äº›ææ–™ç”¨ä»¥è¯æ˜æ”¯æŒSGXçš„é£åœ°</p><p><a href=https://api.portal.trustedservices.intel.com/provisioning-certification>https://api.portal.trustedservices.intel.com/provisioning-certification</a></p></li><li><p>Provisioning Certification Caching Service (PCCS)</p><p>æ•°æ®ä¸­å¿ƒä¸­å¯¹PCSçš„ç¼“å­˜æœåŠ¡ï¼Œç”±æœåŠ¡æä¾›å•†SPç®¡ç†ï¼Œä¸éœ€è¦è¿è¡Œåœ¨SGXå¹³å°ä¹‹ä¸Šï¼ŒSPå¯ä»¥è‡ªå®šä¹‰å…¶å®ç°ã€‚PCCSåœ¨è®¿é—®PCSæ—¶éœ€è¦ä½¿ç”¨åœ¨intelé¡µé¢ä¸Šè®¢é˜…çš„apiå¯†é’¥ã€‚</p></li><li><p>PCK Certificate ID Retrieval Tool</p><p>ä¸€ä¸ªå·¥å…·ï¼Œåœ¨Provisioningé˜¶æ®µä½¿ç”¨ï¼Œç”¨äºè·å–provisioning dataï¼šåŒ…å«äº†è¯¥CPUå”¯ä¸€çš„Platform Provisioning ID (PPID)ï¼Œä»¥åŠTCBä¿¡æ¯ï¼Œç„¶åå‘ç»™PCCSã€‚</p></li></ul><h3 id=ä¸€äº›quote-libraryql>ä¸€äº›Quote Libraryï¼ˆqlï¼‰</h3><ul><li><p>ECDSA Quote Provider Library (qplåº“)</p><p>SPå¯ä»¥è‡ªå®šä¹‰å…¶å®ç°ï¼Œè´Ÿè´£ä»PCCSè·å–PCKè¯ä¹¦ï¼ŒåµŒå…¥åˆ°Quoteé‡Œé¢</p><ul><li>è¿™ä¸ªåº“è¢«åé¢çš„Quote Generation Libraryå’ŒQuote Verification Libraryæ‰€ä¾èµ–</li></ul></li><li><p>ECDSA Quote Generation Library</p><p>è´Ÿè´£ç”ŸæˆQuoteå¹¶ä¸”ä½¿ç”¨å¹³å°å¯†é’¥ç­¾å</p><p>SPå¯ä»¥è‡ªå®šä¹‰å…¶å®ç°ã€‚åŒ…å«äº†PCEå’ŒQE</p></li><li><p>ECDSA Quote Verification Library</p><p>ç”±Intelæä¾›ï¼ŒåŒ…å«äº†QVEã€‚</p><p>åœ¨SGXå¹³å°å’ŒéSGXå¹³å°ä¸Šéƒ½å¯ä»¥è¿è¡Œ</p><blockquote><p>When the platform supports SGX, the library can return an SGX REPORT authenticating the verification result was produced by the IntelÂ® SGX Quote Verification Enclave (QVE).</p></blockquote></li></ul><h3 id=ç‰¹æ®Šçš„enclave>ç‰¹æ®Šçš„Enclave</h3><p><img src=/images/SGX-a3196a0f115b43e6b125299a00ef48aa/Untitled2.png alt=Untitled></p><ul><li><p>Provisioning Certification Enclave (PCE)</p><p>ä¸ºæœ¬åœ°è¿è¡Œçš„QEæ‰®æ¼”äº†ä¸€ä¸ªæœ¬åœ°CAçš„è§’è‰²ï¼ŒæŒæœ‰å¹³å°ç‰¹å®šçš„Provisioning Certification Keyï¼ˆPCKï¼‰ï¼ˆé€šè¿‡<code>EGETKEY</code>è·å¾—ï¼‰ã€‚</p><p>QEå¯ä»¥è‡ªå·±äº§ç”Ÿä¸€å¯¹attestation keyï¼Œç„¶åæŠŠå…¬é’¥ç»™PCEç­¾åå½¢æˆä¸€ä¸ªç±»ä¼¼äºè¯ä¹¦çš„ç»“æ„ï¼ŒåŒ…å«äº†å…¬é’¥å’ŒQEçš„èº«ä»½ä¿¡æ¯ã€‚è¿™ä¸ªç»“æ„ä¼šç”¨PCKç­¾åã€‚</p></li><li><p>Quoting Enclave (QE)</p><p>ä¸EPIDé‡Œçš„QEä¸åŒã€‚</p><p>Intelæä¾›äº†å…¶æºç ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœSPè‡ªå·±ç¼–è¯‘è¿™ä¸ªenclaveï¼Œé‚£ä¹ˆç›¸å½“äºæŠŠSPåŒ…æ‹¬åœ¨äº†TCBä¸­ã€‚å› æ­¤Intelè¿˜æä¾›äº†è‡ªå·±ç­¾åå¥½çš„çš„enclaveäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p></li><li><p>Quote Verification Enclave QVE</p><p>åœ¨Verifyç¯èŠ‚ç”¨åˆ°ï¼Œæ˜¯å¯é€‰çš„ã€‚ç”±DCAP 1.3å¼•å…¥ï¼Œç›®çš„æ˜¯ã€ŒKeeps 3rd party verifiers out of the SGX Attestation TCBã€</p></li></ul><h3 id=keyå’Œcertificate>Keyå’ŒCertificate</h3><ul><li><p>Provisioning Certification Key (PCK)</p><p>PCEæŒæœ‰çš„ä¸€å¯¹å’ŒTCBå…³è”çš„ç­¾åå¯†é’¥ï¼Œç”¨äºå¯¹attestation keyç­¾åã€‚</p></li><li><p>PCK Certificate</p><p>Intelé¢å‘çš„è¯ä¹¦ï¼Œç”±PCSæä¾›</p></li><li><p>Attestation Key</p><p>QEäº§ç”Ÿçš„ä¸€å¯¹éå¯¹ç§°å¯†é’¥</p></li></ul><h3 id=æ•°æ®ç»“æ„-1>æ•°æ®ç»“æ„</h3><ul><li><p>Collateral</p><p>ææ–™ï¼ŒæŒ‡çš„æ˜¯Intel PCSæä¾›çš„è¿œç¨‹è¯æ˜ç›¸å…³çš„ææ–™ï¼Œä¹Ÿå¯ä»¥ä»PCCSé‚£é‡Œè·å¾—</p></li><li><p>Quote</p><p>Quoteä¸­è‡³å°‘åŒ…å«äº†ï¼šattester enclaveçš„å…ƒæ•°æ®ã€QEçš„èº«ä»½æ ‡è¯†ã€PCKè¯ä¹¦ã€</p></li></ul><h3 id=å…¶å®ƒæœ¯è¯­>å…¶å®ƒæœ¯è¯­</h3><ul><li><p>Platform Provisioning ID (PPID)</p><p>Is unique to the platform and PCE identity, but not to the specific TCB. This values and
corresponding TCB SVNs are used to identify the platform when requesting the corresponding PCK certificate from Intel.</p></li></ul><h3 id=ä¸‰ä¸ªè¿‡ç¨‹>ä¸‰ä¸ªè¿‡ç¨‹</h3><p><img src=/images/SGX-a3196a0f115b43e6b125299a00ef48aa/Untitled3.png alt=Untitled></p><ul><li><p>Provisioningè¿‡ç¨‹</p><p>åœ¨è®¾å¤‡åˆå§‹åŒ–æ—¶ï¼Œæˆ–è€…TCBæ›´æ–°æ—¶éœ€è¦é‡æ–°è¿›è¡Œè¯¥è¿‡ç¨‹</p><p>æµç¨‹æ˜¯ï¼š</p><ul><li>è¿è¡ŒPCK Certificate ID Retrieval Toolï¼Œå°†PPIDå’ŒTCBä¿¡æ¯å‘ç»™PCCSè¿›è¡Œæ³¨å†Œã€‚</li><li>PCCSå‘PCSè·å–certificatesï¼Œä»¥åŠå¯¹åº”è¯¥TCB levelçš„å…¶ä½™endorsementsæ•°æ®ï¼ŒPCCSä¼šå°†å…¶å­˜å‚¨èµ·æ¥ã€‚</li></ul></li><li><p>Evidence(Quote) Generationè¿‡ç¨‹</p><ul><li>attesteråº”ç”¨è°ƒç”¨Quote Generation Libraryç”Ÿæˆquoteï¼Œåè€…è°ƒç”¨Quote Provider Libraryå»å‘PCCSè·å–PCKè¯ä¹¦ï¼Œä»¥åµŒå…¥åˆ°quoteä¸­</li></ul></li><li><p>Quote & TCB Verify è¿‡ç¨‹</p><ul><li><p>æ­¥éª¤</p><blockquote><p>To verify an IntelÂ® SGX attestation, the verifier should take the following steps.</p><ol><li>Verify the integrity of the signature chain from the Quote to the Intel-issued PCK certificate.</li><li>Verify no keys in the chain have been revoked.</li><li><strong>Verify the Quoting Enclave is from a suitable source and is up to date.</strong></li><li>Verify the status of the IntelÂ® SGX TCB described in the chain.</li><li>Verify the enclave measurements in the Quote reflect an enclave identity expected.</li></ol></blockquote></li><li><p>éœ€è¦çš„ä¿¡æ¯ï¼Œé™¤äº†quoteä¹‹å¤–è¿˜è¦ï¼š</p><blockquote><ol><li>Intel-issued Certificate for the PCK that certified the attestation key,</li><li>Revocation list that applies to the PCK certificate and any intermediate CA used to certify it.</li><li>Up-to-date SVNs for the CPU & PCE.</li><li>Identity of Quoting Enclave trusted to generate attestation key and issue Quotes.</li></ol></blockquote></li></ul></li></ul><h1 id=å¼€å‘ç›¸å…³>å¼€å‘ç›¸å…³</h1><h2 id=è½¯ä»¶ç»„æˆ>è½¯ä»¶ç»„æˆ</h2><ul><li>SGX driver<ul><li>SGX driverå­˜åœ¨ä¸‰ä¸ªç‰ˆæœ¬ï¼ˆå…·ä½“åŒºåˆ«å¯ä»¥çœ‹ä¸Šé¢çš„pdfæ–‡æ¡£ï¼‰<ul><li>Out-of-tree Driver (/dev/isgx): <a href=https://github.com/intel/linux-sgx-driver>https://github.com/intel/linux-sgx-driver</a><ul><li>2021å¹´åº•åœæ­¢æ›´æ–°ï¼Œé€‚ç”¨äºæ²¡æœ‰Flexible Launch Control (FLC)åŠŸèƒ½çš„CPU</li><li>å¯¹äºarchlinuxç”¨æˆ·ï¼Œå¯ä»¥é€‰æ‹©å®‰è£…aurä¸­çš„linux-sgx-driver-dkms-gitåŒ…</li><li>i5-7200Uæ”¯æŒSGXä½†æ˜¯æ˜¯Legacy Launch Control</li></ul></li><li>DCAP Driver (/dev/{sgx_enclave, sgx_provision}ï¼Œæ–°çš„æ˜¯/dev/sgx/enclaveå’Œ/dev/sgx/provision): <a href=https://github.com/intel/SGXDataCenterAttestationPrimitives/>https://github.com/intel/SGXDataCenterAttestationPrimitives/</a><ul><li>è¾ƒæ–°çš„é©±åŠ¨ï¼Œæ”¯æŒDCAPæ¨¡å¼ï¼Œéœ€è¦Flexible Launch Control.</li></ul></li><li>DCAP Driverï¼ˆIn-kernel Driverï¼‰ (/dev/{sgx_enclave, sgx_provision}): Mainline kernel release 5.11 or higher<ul><li>éœ€è¦Flexible Launch Control.</li></ul></li></ul></li></ul></li><li>SGX PSW<ul><li>å¯¹äºubuntuå’ŒRed Hat Enterprise Linuxç”¨æˆ·ï¼ŒIntel æä¾›äº†repositoryï¼Œå¯ä»¥ç›´æ¥ç”¨åŒ…ç®¡ç†å™¨å®‰è£…ï¼Œå‚è€ƒhttps://download.01.org/intel-sgx/sgx-linux/2.14/docs/Intel_SGX_SW_Installation_Guide_for_Linux.pdf</li></ul></li><li>SGX PSW(SGX Platform SoftWare)
è¯¥éƒ¨åˆ†ä¸»è¦åŒ…å«aesmæœåŠ¡</li><li>SGX SDK
ä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<ul><li>Untrusted RunTime System (URTS)ï¼šè¢«é“¾æ¥åˆ°åŸºäºsgxçš„åº”ç”¨ç¨‹åºä¸­ï¼ˆé€šå¸¸æ˜¯libsgx_urts.soï¼‰ï¼Œé€šè¿‡socketä¸aesmé€šä¿¡</li><li>Trusted RunTime System (TRTS)ï¼šä¸enclaveä»£ç é“¾æ¥åœ¨ä¸€èµ·æ„å»ºæˆELFå…±äº«åº“æ–‡ä»¶</li><li>enclave standard library codeï¼šintelæä¾›çš„ä¸€éƒ¨åˆ†æ ‡å‡†åº“æ–‡ä»¶ï¼Œä¸enclaveä»£ç é“¾æ¥åœ¨ä¸€èµ·</li></ul></li></ul><h2 id=å®‰è£…æ–¹å¼>å®‰è£…æ–¹å¼</h2><ul><li>å»ºè®®é˜…è¯»æ–‡æ¡£
<a href=https://download.01.org/intel-sgx/sgx-linux/2.14/docs/Intel_SGX_SW_Installation_Guide_for_Linux.pdf>https://download.01.org/intel-sgx/sgx-linux/2.14/docs/Intel_SGX_SW_Installation_Guide_for_Linux.pdf</a></li><li>ä»dockerä¸­å¯åŠ¨sgxå¼€å‘ç¯å¢ƒ<ul><li><p>ä½¿ç”¨githubçš„intel/linux-sgxä»“åº“ä¸­<code>linux/installer/docker</code>ç›®å½•ä¸‹çš„çš„æ–‡ä»¶æ¥æ„å»ºã€‚</p></li><li><p>è¿™é‡Œæˆ‘åšäº†ä¸€äº›ä¿®æ”¹æ¥åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨æ¥å¼€å‘sgxç¨‹åºçš„é•œåƒ</p></li><li><p>è¿è¡ŒaesmæœåŠ¡æ‰€åœ¨çš„dockerå®¹å™¨ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>build_and_run_aesm_docker.sh
</span></span></code></pre></div></li><li><p>åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªsgxå¼€å‘ç¯å¢ƒçš„dockerå®¹å™¨
è¿›å…¥è¯¥å®¹å™¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build --target sgx_sdk --build-arg https_proxy<span style=color:#f92672>=</span>$https_proxy --build-arg http_proxy<span style=color:#f92672>=</span>$http_proxy -t sgx_sdk -f ./Dockerfile ./
</span></span><span style=display:flex><span>docker create --device<span style=color:#f92672>=</span>/dev/isgx -v aesmd-socket:/var/run/aesmd --network<span style=color:#f92672>=</span>host -v /run/media/imlk/Data/workspace/sgx:/code --name<span style=color:#f92672>=</span>sgx_sdk_container -t -i sgx_sdk
</span></span><span style=display:flex><span>docker start sgx_sdk_container
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it sgx_sdk_container /bin/bash
</span></span></code></pre></div></li></ul></li></ul></main><div id=comments><hr><script src=//geoip-js.com/js/apis/geoip2/v2.1/geoip2.js type=text/javascript></script><script>var onSuccess=function(e){var t=e.country.names["zh-CN"],n=e.country.iso_code;if(!n)return;t&&(document.getElementById("comments-blocked-country-code").innerHTML=t),n=="CN"&&(document.getElementById("comments-shown").style.display="none",document.getElementById("comments-blocked").style.display="")},onError=function(){};geoip2.country(onSuccess,onError)</script><div id=comments-blocked style=font-style:italic;color:#777;display:none>è¯„è®ºåŒºå·²å…³é—­ã€‚<span style=float:right>æ¥è‡ª <span id=comments-blocked-country-code>unknown</span> çš„è®¿å®¢
<span>&nbsp; - powered by: geoip-js.com</span></span></div><div id=comments-shown><script src=https://utteranc.es/client.js repo=imlk0/imlk0.github.io issue-term=pathname label='ğŸ’¬ comments ğŸ’¬' theme=github-light crossorigin=anonymous async></script></div></div><footer class=footer><hr>Â© imlk 2017 &ndash; 2023 | <a href=https://blog.imlk.top>imlk's blog</a> | <a href=https://github.com/imlk0/>Github</a> | <a href=mailto:me@imlk.top>Email</a> | <a href=https://beian.miit.gov.cn/>äº¬ICPå¤‡2020042968å·-1</a></footer></body></html>