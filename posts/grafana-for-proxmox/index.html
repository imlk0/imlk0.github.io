<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>ProxmoxæœåŠ¡å™¨çš„Grafanaçœ‹æ¿ç®€æ˜“é…ç½® | imlk's blog</title>
<link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel=stylesheet></head><body><header class=header><a class=logo href=/>imlk's Blog</a><nav><ul class=menu><li><a href=/>ğŸ Home</a></li><li><a href=/about/>ğŸ‘‹About</a></li><li><a href=/archives/>ğŸ“œArchives</a></li><li><a href=/friends/>ğŸ”—Friends</a></li><li><a href=/dn42/>ğŸ•¸ï¸DN42</a></li><li><a href=/index.xml>ğŸ“¢Subscribe</a></li></ul></nav></header><hr><div class=article-meta><h1><span class=title>ProxmoxæœåŠ¡å™¨çš„Grafanaçœ‹æ¿ç®€æ˜“é…ç½®</span></h1><span><span class=date>ğŸ“… 2022-09-04</span>
<span class=date>(æ›´æ–°äº2022-09-05)</span>
/
<span class=cats>ğŸ“š
<a href=https://blog.imlk.top/categories/misc/>Misc</a>
</span>/
<span class=tags>ğŸ·ï¸
<a href=https://blog.imlk.top/tags/proxmox/>#Proxmox</a>
<a href=https://blog.imlk.top/tags/grafana/>#Grafana</a>
<a href=https://blog.imlk.top/tags/influxdb/>#InfluxDB</a></span></span><br></div><main class=post-content><p>ITXæ‹¿æ¥åšPVEæœåŠ¡å™¨å·²ç»ç”¨äº†å¥½å‡ ä¸ªæœˆçš„æ—¶é—´äº†ï¼Œä½“éªŒè¿˜æ˜¯ç›¸å½“ä¸é”™çš„ï¼Œä½†æ˜¯ç¼ºä¹ä¸€ä¸ªç›´è§‚çš„æ€§èƒ½çœ‹æ¿ã€‚æ—©å¬è¯´PVEçš„Metric Serverç‰¹æ€§å¯ä»¥ç”¨æ¥ç›‘è§†æ€§èƒ½ï¼Œæ°é€¢æœ€è¿‘æœ‰çœ‹åˆ°æœ‰äººæ¨Grafanaï¼Œå› æ­¤å‡†å¤‡æ¥ä½“éªŒä¸€ä¸‹ã€‚</p><h1 id=å‰å¥>å‰å¥</h1><p>é¦–å…ˆå‚è€ƒä¸€ä¸‹PVEçš„å®˜æ–¹<a href=https://pve.proxmox.com/wiki/External_Metric_Server#metric_server_influxdb>æ–‡æ¡£</a>å…³äºMetric Serverçš„æè¿°ã€‚</p><p>åˆ«çœ‹è¿™æ–‡æ¡£è™½ç„¶çŸ­å°ï¼Œä½†ä¹Ÿæ½œè—ç€ä¸å°‘å‘ã€‚ç”±äºæˆ‘ä»¬çš„å®éªŒæ˜¯ä»¥InfluxDB V2ç‰ˆæœ¬è¿›è¡Œã€‚é¦–å…ˆæ–‡æ¡£ä¸­çš„é…ç½®æ–‡ä»¶å†…å®¹æ˜¯é’ˆå¯¹InfluxDB V1çš„ï¼Œåœ¨InfluxDB V2ä¸­ä¸å†é€‚ç”¨ã€‚ä¸”æ–‡æ¡£å»ºè®®ä½¿ç”¨UDPè¿æ¥InfluxDBï¼Œä½†æ˜¯InfluxDB V2ä¸­é»˜è®¤å·²ç»æ˜¯httpäº†ã€‚å¹¸è¿çš„æ˜¯è¿™æ–‡æ¡£é‡Œå¯¹V2çš„é…ç½®æäº†ä¸€å˜´ã€‚</p><h1 id=é…ç½®influxdb>é…ç½®InfluxDB</h1><p>é‚£ä¹ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªlxcå®¹å™¨éƒ¨ç½²æˆ‘ä»¬çš„InfluxDBæœåŠ¡å’ŒGrafanaæœåŠ¡ã€‚</p><p>åœ¨lxcå®¹å™¨é‡Œè£…å¥½influxdbå’Œinflux-cliå¹¶å¯åŠ¨influxdb</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>systemctl enable --now influxdb
</span></span></code></pre></div><p>å¯åŠ¨åé»˜è®¤ç›‘å¬httpç«¯å£æ˜¯<code>8086</code>ï¼ŒWebUIå’ŒAPIæ¥å£éƒ½åœ¨è¿™ä¸ªç«¯å£ä¸Šè®¿é—®</p><p>é¦–æ¬¡å¯åŠ¨éœ€è¦è¿›è¡ŒSetupï¼Œå¯ä»¥ä»WebUIä¸ŠSetupï¼Œä¹Ÿå¯ä»¥åœ¨CLIå·¥å…·ä¸ŠSetupã€‚å¯ä»¥å‚è€ƒinfluxdbçš„<a href="https://docs.influxdata.com/influxdb/v2.4/install/?t=Linux#set-up-influxdb">æ–‡æ¡£</a></p><p>è¿™é‡Œæˆ‘ä»¬ç”¨CLIå·¥å…·è¿›è¡Œsetupã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>influx setup
</span></span></code></pre></div><p>è¿™æ˜¯ä¸€ä¸ªäº¤äº’å¼çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªåä¸º<code>proxmox</code>çš„organizationå’Œä¸€ä¸ªåä¸º<code>proxmox</code>çš„bucket/databaseã€‚</p><h1 id=é…ç½®pveä¾§metric-server>é…ç½®PVEä¾§Metric Server</h1><p>åœ¨proxmoxä¸Šé…ç½®(Datacenter -> Metric Server -> Add -> InfluxDB)ï¼š</p><p>è¦è·å¾—tokenï¼Œè¿è¡Œï¼š</p><pre tabindex=0><code>influx config list --json
</code></pre><p><img src=/images/proxmox-influxdb-01.png alt></p><h1 id=é…ç½®grafana>é…ç½®Grafana</h1><p>å®‰è£…å¹¶å¯åŠ¨Grafana</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>systemctl enable --now grafana
</span></span></code></pre></div><p>è®¿é—®WebUIï¼Œé»˜è®¤ç«¯å£æ˜¯3000</p><h2 id=æ·»åŠ influxdbä½œä¸ºæ•°æ®æº>æ·»åŠ InfluxDBä½œä¸ºæ•°æ®æº</h2><p>æ¥ä¸‹æ¥è¿æ¥InfluxDBï¼Œåœ¨WebUIä¸Šé€‰æ‹©<code>Add data source</code>ã€‚</p><p>Query Languageé€‰æ‹©<code>Flux</code>ï¼Œå¡«å†™InfluxDBçš„URLã€‚</p><p><img src=/images/proxmox-grafana-01.png alt></p><p>å…³æ‰Basic authï¼Œå‰©ä½™çš„Organizationå’ŒDefault Bucketå¡«<code>proxmox</code>ï¼ŒTokenå¡«ä½ çš„token</p><p><img src=/images/proxmox-grafana-02.png alt></p><h2 id=è®¾ç½®proxmox-dashboard>è®¾ç½®Proxmox Dashboard</h2><p>æ¥ç€Import <a href=https://grafana.com/grafana/dashboards/15356-proxmox-flux/>è¿™ä¸ª</a>IDä¸º<code>15356</code>çš„dashboardå°±å¯ä»¥äº†</p><p>è®°å¾—é¡¶ä¸Šçš„Bucketé€‰<code>proxmox</code>ä¸ç„¶æ˜¯No Dataã€‚</p><p><img src=/images/proxmox-grafana-03.png alt></p></main><div id=comments><hr><script src=//geoip-js.com/js/apis/geoip2/v2.1/geoip2.js type=text/javascript></script><script>var onSuccess=function(e){var t=e.country.names["zh-CN"],n=e.country.iso_code;if(!n)return;t&&(document.getElementById("comments-blocked-country-code").innerHTML=t),n=="CN"&&(document.getElementById("comments-shown").style.display="none",document.getElementById("comments-blocked").style.display="")},onError=function(){};geoip2.country(onSuccess,onError)</script><div id=comments-blocked style=font-style:italic;color:#777;display:none>è¯„è®ºåŒºå·²å…³é—­ã€‚<span style=float:right>æ¥è‡ª <span id=comments-blocked-country-code>unknown</span> çš„è®¿å®¢
<span>&nbsp; - powered by: geoip-js.com</span></span></div><div id=comments-shown><script src=https://utteranc.es/client.js repo=imlk0/imlk0.github.io issue-term=pathname label='ğŸ’¬ comments ğŸ’¬' theme=github-light crossorigin=anonymous async></script></div></div><footer class=footer><hr>Â© imlk 2017 &ndash; 2023 | <a href=https://blog.imlk.top>imlk's blog</a> | <a href=https://github.com/imlk0/>Github</a> | <a href=mailto:me@imlk.top>Email</a> | <a href=https://beian.miit.gov.cn/>äº¬ICPå¤‡2020042968å·-1</a></footer></body></html>