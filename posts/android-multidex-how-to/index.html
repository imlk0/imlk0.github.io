<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>ä¸ºXposedæ¨¡å—å¢åŠ Multidexæ”¯æŒå¹¶æŒ‡å®šä¸»dexä¸­çš„class | imlk's blog</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel=stylesheet></head><body><header class=header><a class=logo href=/>imlk's Blog</a><nav><ul class=menu><li><a href=/>ğŸ Home</a></li><li><a href=/about/>ğŸ‘‹About</a></li><li><a href=/archives/>ğŸ“œArchives</a></li><li><a href=/friends/>ğŸ”—Friends</a></li><li><a href=/dn42/>ğŸ•¸ï¸DN42</a></li><li><a href=/index.xml>ğŸ“¢Subscribe</a></li></ul></nav></header><hr><div class=article-meta><h1><span class=title>ä¸ºXposedæ¨¡å—å¢åŠ Multidexæ”¯æŒå¹¶æŒ‡å®šä¸»dexä¸­çš„class</span></h1><span><span class=date>ğŸ“… 2018-04-29</span>
<span class=date>(æ›´æ–°äº2021-10-10)</span>
/
<span class=cats>ğŸ“š
<a href=https://blog.imlk.top/categories/android/>Android</a></span>
/
<span class=tags>ğŸ·ï¸
<a href=https://blog.imlk.top/tags/multidex/>#Multidex</a>
<a href=https://blog.imlk.top/tags/zjdroid/>#ZjDroid</a>
<a href=https://blog.imlk.top/tags/xposed/>#Xposed</a></span></span><br></div><main class=post-content><h3 id=èµ·å› >èµ·å› </h3><p>åœ¨ç¼–è¯‘ZjDroidæºç çš„æ—¶å€™é‡åˆ°äº†è‘—åçš„æ–¹æ³•æ•°è¶…å‡º<code>65536</code>ä¸ªçš„é—®é¢˜ã€‚</p><p>æˆ‘çš„<code>gradle</code>ç‰ˆæœ¬</p><pre tabindex=0><code>        classpath &#39;com.android.tools.build:gradle:3.1.2&#39;
</code></pre><h3 id=è¦è§£å†³çš„é—®é¢˜>è¦è§£å†³çš„é—®é¢˜</h3><ol><li><code>Xposed</code>æ¨¡å—ä¸­çš„æ–¹æ³•æ•°è¶…è¿‡äº†<code>65536</code>ä¸ªï¼Œéœ€è¦è¿›è¡Œåˆ†åŒ…æ“ä½œ</li><li>åˆ†åŒ…ä»¥åå¦‚ä½•åœ¨æ¨¡å—è¢«åŠ è½½æ‰§è¡Œå‰å°½å¯èƒ½æ—©çš„æŠŠå…¶ä½™çš„dexåŠ è½½è¿›æ¥</li><li>æœ€åé‡åˆ°çš„é—®é¢˜ï¼šæŠŠæ¨¡å—çš„å…¥å£ç±»æŒ‡å®šåˆ°ç¬¬ä¸€ä¸ªdexä¸­</li></ol><h3 id=é—®é¢˜1>é—®é¢˜1</h3><p>å…³äºåˆ†åŒ…æ“ä½œï¼š</p><p>æœäº†åŠå¤©ï¼Œæœåˆ°çš„è§£å†³åŠæ³•æ˜¯ï¼š
<code>gradle.build</code>ä¸­åœ¨<code>defaultConfig</code>ä¸­æ·»åŠ </p><pre tabindex=0><code>        multiDexEnabled true
</code></pre><p>è®©ç¼–è¯‘è„šæœ¬å¼€å¯åˆ†åŒ…</p><h3 id=é—®é¢˜2>é—®é¢˜2</h3><p>å…³äºåˆ†åŒ…åçš„åŠ è½½é—®é¢˜ï¼š</p><p>ç½‘ä¸Šå¯¹äºä¸€èˆ¬åº”ç”¨çš„è§£å†³åŠæ³•æ˜¯</p><p>å¼•å…¥</p><pre tabindex=0><code>    implementation &#39;com.android.support:multidex:1.0.3&#39;
</code></pre><p>åœ¨<code>Application</code>ä¸­è°ƒç”¨</p><pre tabindex=0><code>        MultiDex.install(this);
</code></pre><p>æ¥å®ç°åˆ†åŒ…åº”ç”¨çš„å¯åŠ¨ã€‚</p><p><strong>ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯è¿™ä¸ª<code>Multidex</code>çš„<code>install</code>æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª<code>Context</code>å®ä¾‹ï¼Œè€Œ<code>Xposed</code>æ¨¡å—çš„å¯åŠ¨æ˜¯æ²¡æœ‰<code>Application</code>çš„ï¼Œæ€ä¹ˆåŠå‘¢ï¼Œå¦‚æœè¦æˆªè·å®¿ä¸»çš„<code>Application</code>åˆæ¯”è¾ƒéº»çƒ¦ï¼Œèƒ½ä¸èƒ½ç›´æ¥ä¸€å¥è¯å®Œæˆå‘¢ï¼Ÿ</strong></p><p>äºæ˜¯æˆ‘å†³å®šå»ç ”ç©¶ç ”ç©¶<code>MultiDex</code>çš„æºç ï¼Œå°è¯•é­”æ”¹å‡ºä¸€ä¸ªé€‚ç”¨äº<code>Xposed</code>æ¨¡å—çš„<code>MultiDex.install()</code>ã€‚</p><h3 id=é­”æ”¹ä¹‹æ—…>é­”æ”¹ä¹‹æ—…</h3><p>ç ”ç©¶äº†ä¸€ç•ªå‘ç°ï¼Œä¼ å…¥çš„<code>Context</code>çš„ä¸»è¦ç”¨é€”æœ‰ï¼š</p><ol><li>ä¼ å…¥<code>getApplicationInfo</code>æ–¹æ³•è·å–<code>ApplicationInfo</code></li><li>è·å–åº”ç”¨çš„ç§æœ‰å‚¨å­˜ç©ºé—´è·¯å¾„å¹¶å¾€é‡Œé¢è§£å‹<code>dex</code>æ–‡ä»¶</li><li>è·å–<code>SharedPreferences</code>å‚¨å­˜ä¸€äº›å’Œ<code>dex</code>æ–‡ä»¶æ•°é‡ä»¥åŠæ–‡ä»¶æ ¡éªŒç›¸å…³çš„ä¿¡æ¯ï¼ˆè€ƒè™‘çš„è¿˜æŒºå‘¨åˆ°ï¼‰</li></ol><p>æˆ‘å‘ç°åœ¨æ¨¡å—çš„</p><pre tabindex=0><code>    public void handleLoadPackage(LoadPackageParam lpparam) throws Throwable {
</code></pre><p>è¿™ä¸ªå…¥å£å‡½æ•°çš„å‚æ•°<code>lpparam</code>ä¸­ï¼Œèƒ½è·å–åˆ°å®¿ä¸»çš„<code>ApplicationInfo</code>ï¼Œä»è€Œè·å–åˆ°å®¿ä¸»åº”ç”¨çš„ç§æœ‰æ–‡ä»¶å¤¹è·¯å¾„</p><p>è¿™æ ·æˆ‘å°±èƒ½å¾€é‡Œé¢è§£å‹æ–‡ä»¶å•¦</p><p>è‡³äºæ–‡ä»¶æ ¡éªŒï¼Œè¿™ä¸ªå°±ä¸åšäº†ï¼Œï¼ˆåŸæ–¹æ¡ˆæ˜¯ä¸€æ¬¡å¯åŠ¨çš„æ—¶å€™è§£å‹ï¼Œç„¶åä»¥åå¯åŠ¨çš„æ—¶å€™å°±å»æ ¡éªŒè¿™ä¸ªæ–‡ä»¶ï¼Œå†åŠ è½½è¿›æ¥ï¼‰ï¼Œæˆ‘å°±å¹²è„†æ¯æ¬¡å¯åŠ¨çš„æ—¶å€™éƒ½è¦è§£å‹ï¼ŒåŠ è½½å®Œå†åˆ æ‰å°±okäº†ã€‚</p><h3 id=é­”æ”¹å®Œæˆ>é­”æ”¹å®Œæˆ</h3><p>é¡¹ç›®åœ°å€ï¼š
<a href=https://github.com/KB5201314/XposedModuleMultidex>https://github.com/KB5201314/XposedModuleMultidex</a></p><p>æ·»åŠ ä¾èµ–</p><pre tabindex=0><code>  compile &#39;top.imlk.xpmodulemultidex:XposedModuleMultidex:1.0.0&#39;
</code></pre><p>åˆ äº†ä¸€å¤§å †ï¼Œæ€»ç®—æ˜¯é­”æ”¹å‡ºæ¥äº†ä¸€ä¸ªï¼Œè™½ç„¶åªæœ‰ä¸¤ä¸ªæ–‡ä»¶ã€‚ã€‚ã€‚ã€‚ä½†è¿˜æ˜¯å€¼å¾—åº†å¹¸çš„ï¼</p><p>è·å–<code>module</code>çš„å®‰è£…åŒ…è·¯å¾„ï¼š</p><p>é€šè¿‡ç»™å…¥å£ç±»ç»§æ‰¿<code>IXposedHookZygoteInit</code>å¹¶å®ç°<code>initZygote</code>æ–¹æ³•</p><pre tabindex=0><code>    @Override
    public void initZygote(StartupParam startupParam) throws Throwable {
        MODULE_PATH = startupParam.modulePath;
    }
</code></pre><p>å°±èƒ½æ‹¿åˆ°æ¨¡å—çš„å®‰è£…åŒ…è·¯å¾„å•¦ã€‚</p><p>ç„¶ååœ¨<code>handleLoadPackage</code>ä¸­æ‰§è¡Œ</p><pre tabindex=0><code>...
    @Override
    public void handleLoadPackage(LoadPackageParam lpparam) throws Throwable {
        XMMultiDex.install(ReverseXposedModule.class.getClassLoader(),MODULE_PATH,lpparam.appInfo);
...
</code></pre><p>å…¶ä¸­<code>ReverseXposedModule</code>å°±æ˜¯æˆ‘è¿™ä¸ªæ¨¡å—çš„å…¥å£ç±»çš„åç§°å•¦ã€‚</p><h3 id=é—®é¢˜3>é—®é¢˜3</h3><p><strong>æŒ‡å®šä¸»<code>dex</code>ä¸­çš„<code>class</code>æ–‡ä»¶çš„é—®é¢˜</strong></p><p>è¿™å¯åºŸäº†æˆ‘ä¸å°‘æ—¶é—´å•Šï¼Œç½‘ä¸Šçš„æ–¹æ³•å¤§å¤šéƒ½è¿‡æ—¶äº†ï¼Œå”¯ä¸€ä¸€ä¸ªçœ‹ç€é è°±çš„æ’ä»¶<code>DexKnifePlugin</code>ä¹Ÿç”¨ä¸äº†ï¼Œæœäº†åŠå¤©ï¼Œç»ˆäºæ‰¾åˆ°ä¸€ä½ä»å…„çš„æ–¹æ³•</p><p>åœ¨<code>gradle.build</code>çš„<code>defaultConfig</code>ä¸­å¯ä»¥æŒ‡å®šä¸€ä¸ªæ–‡ä»¶æ¥è¡¨ç¤ºè¦æ”¾åœ¨ç¬¬ä¸€ä¸ª<code>dex</code>ä¸­çš„<code>class</code></p><p>åŠ å…¥</p><pre tabindex=0><code> multiDexKeepFile file(&#39;maindexlist.txt&#39;)
</code></pre><p>ç„¶ååœ¨<code>gradle.build</code>çš„åŒçº§ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶<code>maindexlist.txt</code></p><p>é‡Œé¢å¡«ä¸Šè¦æ”¾åœ¨ç¬¬ä¸€ä¸ª<code>dex</code>ä¸­çš„<code>class</code></p><p>å¦‚ï¼š</p><pre tabindex=0><code>com/android/reverse/mod/ReverseXposedModule.class
top/imlk/xpmodulemultidexer/XMMultiDex.class
</code></pre><p>ä¹Ÿå¯ä»¥ç”¨</p><pre tabindex=0><code> multiDexKeepProguard file(&#39;maindexlist.pro&#39;)
</code></pre><p>ç„¶å
æ–°å»º<code>maindexlist.pro</code>æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨<code>proguard</code>è¯­æ³•æ¥å†™</p><pre tabindex=0><code>-keep class com.android.reverse.mod.ReverseXposedModule
-keep class top.imlk.xpmodulemultidexer.*
</code></pre><p>å¯ç®—æ˜¯okäº†</p><h3 id=å‚è€ƒèµ„æ–™>å‚è€ƒèµ„æ–™</h3><p>gradle3.0.0åˆ†åŒ…æŠŠæŒ‡å®šçš„classæ”¾åˆ°maindexé‡Œé¢:
<a href=https://blog.csdn.net/qq_17265737/article/details/79074494>https://blog.csdn.net/qq_17265737/article/details/79074494</a>
ç†è§£ Multidex ç”Ÿæˆï¼š
<a href=http://www.jkeabc.com/566905.html>http://www.jkeabc.com/566905.html</a></p></main><div id=comments><hr><script src=https://utteranc.es/client.js repo=KB5201314/KB5201314.github.io issue-term=pathname label='ğŸ’¬ comments ğŸ’¬' theme=github-light crossorigin=anonymous async></script></div><footer class=footer><hr>Â© imlk 2017 &ndash; 2023 | <a href=https://blog.imlk.top>imlk's blog</a> | <a href=https://github.com/KB5201314/>Github</a> | <a href=mailto:me@imlk.top>Email</a> | <a href=https://beian.miit.gov.cn/>äº¬ICPå¤‡2020042968å·-1</a></footer></body></html>