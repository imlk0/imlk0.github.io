<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>ç†è§£MindSpore Liteè®¡ç®—å›¾ä¸è‡ªå®šä¹‰ç®—å­ | imlk's blog</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel=stylesheet></head><body><header class=header><a class=logo href=/>imlk's Blog</a><nav><ul class=menu><li><a href=/>ğŸ Home</a></li><li><a href=/about/>ğŸ‘‹About</a></li><li><a href=/archives/>ğŸ“œArchives</a></li><li><a href=/friends/>ğŸ”—Friends</a></li><li><a href=/dn42/>ğŸ•¸ï¸DN42</a></li><li><a href=/index.xml>ğŸ“¢Subscribe</a></li></ul></nav></header><hr><div class=article-meta><h1><span class=title>ç†è§£MindSpore Liteè®¡ç®—å›¾ä¸è‡ªå®šä¹‰ç®—å­</span></h1><span><span class=date>ğŸ“… 2022-09-25</span>
<span class=date>(æ›´æ–°äº2023-08-30)</span>
/
<span class=cats>ğŸ“š
<a href=https://blog.imlk.top/categories/ai/>AI</a></span>
/
<span class=tags>ğŸ·ï¸
<a href=https://blog.imlk.top/tags/mindspore/>#MindSpore</a>
<a href=https://blog.imlk.top/tags/ai/>#AI</a></span></span><br></div><main class=post-content><h1 id=mindspore-æ¨¡å‹æ ¼å¼>MindSpore æ¨¡å‹æ ¼å¼</h1><ul><li><a href=https://www.mindspore.cn/lite/docs/zh-CN/r1.8/use/converter_tool.html><code>converter_lite</code></a>å·¥å…·<ul><li>æ”¯æŒçš„è¾“å…¥æ ¼å¼ï¼šMINDIR(MindSpore <code>.mindir</code>)ã€CAFFEã€TFLITEã€TFã€ONNX</li><li>è¾“å‡ºæ ¼å¼MINDIR_LITE(<code>.ms</code>)</li></ul></li><li>MINDIR(<code>.mindir</code>)<ul><li>MindSporeçš„æ¨¡å‹æ–‡ä»¶ï¼Œprotobuffæ ¼å¼</li></ul></li><li>MINDIR_LITE(<code>.ms</code>)<ul><li><p>ç›®å‰æ˜¯<code>MSL2</code>ç‰ˆæœ¬ï¼Œflatbufferåºåˆ—åŒ–æ–‡ä»¶ï¼Œå¯æ¨ç†ï¼Œå¯è®­ç»ƒã€‚æ—§ç‰ˆä¸º<code>MSL0</code>ç‰ˆæœ¬</p></li><li><p><a href=https://github.com/mindspore-ai/mindspore/blob/d351abb9f16a337610400ef5eba7af58bf291fb3/mindspore/lite/schema/model.fbs#L22>schemaæ–‡ä»¶</a></p></li><li><p>MindIR</p><ul><li>IRçš„å®šä¹‰https://www.mindspore.cn/docs/zh-CN/r0.7/design/mindspore/ir.html</li><li>å¯¹åº”Liteç®—å­https://www.mindspore.cn/lite/docs/zh-CN/r1.8/operator_list_lite.html</li></ul></li></ul></li></ul><h1 id=mindsporeè®¡ç®—å›¾ç»“æ„>MindSporeè®¡ç®—å›¾ç»“æ„</h1><ul><li>SubGraphï¼šæ¨¡å‹æ˜¯ç”±ç›¸äº’åµŒå¥—çš„å¤šä¸ªSubGraphç»„æˆçš„</li><li>Tensorï¼šç¥ç»å…ƒï¼Œè¡¨ç¤ºå„å±‚çš„è¾“å…¥è¾“å‡ºï¼Œæƒé‡</li><li>Primitiveï¼šMindsporeå®šä¹‰çš„ä¸€ç§IRçš„ç®—å­</li><li>CNodeï¼šè¡¨ç¤ºå›¾ä¸Šçš„ä¸€ä¸ªç®—å­è¡Œä¸ºï¼ŒåŒ…å«äº†ï¼šè¾“å…¥è¾“å‡ºçš„tensorï¼Œç”±Primitiveè¡¨ç¤ºçš„å…·ä½“çš„ç®—å­ç±»å‹<ul><li>æ³¨æ„ï¼Œmindsporeçš„ç®—å­çš„è¾“å…¥è¾“å‡ºå¯ä»¥æœ‰å¤šä¸ª</li><li>æ³¨æ„ï¼Œå…¶ä¸­çš„device_typeå­—æ®µå‡ ä¹å¯ä»¥å¿½ç•¥ï¼Œç›®å‰ä»…ä¸¤ä¸ªç”¨é€”ã€‚1. ä»…åœ¨GPUçš„ä¼˜å…ˆçº§é«˜äºCPUä¸”è¯¥å­—æ®µè®¾ç½®ä¸ºGPUæ—¶ï¼Œè¯¥èŠ‚ç‚¹æ‰ä¼šé€‰æ‹©ä½¿ç”¨GPUçš„Kernelã€‚2. ä»…åœ¨å¼€å¯äº†<a href=https://www.mindspore.cn/lite/docs/zh-CN/r1.8/use/runtime_cpp.html#%E9%85%8D%E7%BD%AE%E5%B9%B6%E8%A1%8C%E7%AD%96%E7%95%A5>æ¨¡å‹å¹¶è¡Œç­–ç•¥æ—¶æ‰ä¼šå½±å“</a>SetEnableParallel</li></ul></li><li>PartialFusionï¼šä¸€ä¸ªç‰¹æ®Šçš„ç®—å­ï¼Œè¡¨ç¤ºä¸€ä¸ªå­å›¾åŒ…å«äº†ä¸€ä¸ªSubGraphçš„ç´¢å¼•å·</li></ul><h1 id=mindsporeæ¨¡å‹åˆå§‹åŒ–æµç¨‹>MindSporeæ¨¡å‹åˆå§‹åŒ–æµç¨‹</h1><ol><li><code>LiteModel::ConstructModel()</code>Â ä»flatbuffersåˆ›å»ºLiteModelå¯¹è±¡ã€‚<ol><li><code>LiteModel::ConvertNodes()</code>Â ä»flatbuffersåˆå§‹åŒ–<code>mindspore::lite::LiteGraph::Node</code>å¯¹è±¡</li><li><code>LiteModel::ConvertTensors()</code>Â ä»flatbuffersåˆå§‹åŒ–<code>mindspore::schema::Tensor</code>å¯¹è±¡</li></ol></li><li><code>LiteSession::CompileGraph(Model *model)</code><ol><li><code>LiteSession::ConvertTensors()</code>Â æ ¹æ®æ¨¡å‹ä¸­å®šä¹‰çš„<code>mindspore::schema::Tensor</code>å¯¹è±¡å®ä¾‹åŒ–æˆ<code>mindspore::lite::Tensor</code>å¯¹è±¡</li><li><code>Scheduler::Schedule(std::vector&lt;kernel::KernelExec *> *dst_kernels)</code>Â å®ä¾‹åŒ–<code>mindspore::kernel::KernelExec</code>å¯¹è±¡<ol><li><code>Scheduler::ScheduleGraphToKernels()</code>Â å°†å›¾è½¬æ¢æˆKernelExecå¯¹è±¡</li><li>è¿›è¡Œæ‹“æ‰‘æ’åºã€å°†è¿ç»­çš„KernelæŒ‰ç…§archç±»å‹åˆå¹¶æˆSubGraph</li></ol></li></ol></li></ol><h1 id=mindsporeçš„æ‰©å±•>MindSporeçš„æ‰©å±•</h1><ol><li><p><a href=https://www.mindspore.cn/lite/docs/zh-CN/r1.8/use/register_kernel.html#%E9%80%9A%E7%94%A8%E7%AE%97%E5%AD%90>è‡ªå®šä¹‰è¿è¡Œæ—¶ç®—å­â€”â€”é€šç”¨ç®—å­</a>ï¼šå¯¹Primitiveåˆ—è¡¨ä¸­ï¼Œå·²æœ‰ç®—å­ï¼ˆå¦‚Addï¼‰å®ç°çš„é‡å†™</p></li><li><p><a href=https://www.mindspore.cn/lite/docs/zh-CN/r1.8/use/register_kernel.html#custom%E7%AE%97%E5%AD%90>è‡ªå®šä¹‰è¿è¡Œæ—¶ç®—å­â€”â€”Customç®—å­</a>ï¼šå®šä¹‰ä¸€ç§æ–°çš„ç®—å­ï¼Œä½¿ç”¨Primitiveåˆ—è¡¨ä¸­çš„Primitive::Customç®—å­æ¥å£ï¼Œæ„å»ºä¸“å±çš„å®ç°ã€‚å…¶ä¸­typeå’Œattræ˜¯å¯ä»¥è‡ªå®šä¹‰çš„å±æ€§</p><pre tabindex=0><code>table Custom {
     type: string;
     attr: [Attribute];
}
</code></pre></li><li><p><a href=https://www.mindspore.cn/lite/docs/zh-CN/r1.8/use/delegate.html>æ¨¡å‹Delegate</a>Â æä¾›å°†æ¨¡å‹ä¸­çš„ä¸€éƒ¨åˆ†å­å›¾å¸è½½åˆ°åˆ«çš„æ¡†æ¶æ‰§è¡Œçš„èƒ½åŠ›</p></li><li><p><a href=https://www.mindspore.cn/lite/docs/zh-CN/r1.8/use/converter_register.html#%E6%A8%A1%E5%9E%8B%E6%89%A9%E5%B1%95>æ¨¡å‹è½¬æ¢ä¸­å®šä¹‰ç®—å­</a>Â converterå·¥å…·æä¾›äº†ä¸€ç§ç§°ä¸ºã€Œå›¾ä¼˜åŒ–æ‰©å±•ã€çš„èƒ½åŠ›ï¼ˆå®é™…ä¸Šæ˜¯å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„Passï¼‰ï¼Œå¯ä»¥åœ¨è·å¾—MindSporeå®šä¹‰çš„å›¾ç»“æ„çš„åŸºç¡€ä¸Šï¼Œå¯¹å›¾è¿›è¡Œä¿®æ”¹ï¼Œå¯å°†éƒ¨åˆ†èŠ‚ç‚¹è½¬æ¢æˆCustomç®—å­ã€‚</p></li></ol></main><div id=comments><hr><script src=https://utteranc.es/client.js repo=KB5201314/KB5201314.github.io issue-term=pathname label='ğŸ’¬ comments ğŸ’¬' theme=github-light crossorigin=anonymous async></script></div><footer class=footer><hr>Â© imlk 2017 &ndash; 2023 | <a href=https://blog.imlk.top>imlk's blog</a> | <a href=https://github.com/KB5201314/>Github</a> | <a href=mailto:me@imlk.top>Email</a> | <a href=https://beian.miit.gov.cn/>äº¬ICPå¤‡2020042968å·-1</a></footer></body></html>